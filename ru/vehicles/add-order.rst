Создание заказа или добавление нового элемента
##############################################

Описание XML схемы
==================

XSD-схемы для создания заказа или добавления нового авто:

:download:`www/xsd/order/AddOrderRequest.xsd <../../themes/hotelbook/static/xsd/order/AddOrderRequest.xsd>`

:download:`www/xsd/order/AddOrderResponse.xsd <../../themes/hotelbook/static/xsd/order/AddOrderResponse.xsd>`

После того, как был произведён поиск авто, можно создать заказ, с одним
или несколькими авто. При создании заказа указываются контактная
информация: ф.и.о., email адрес, телефон и если нужно комментарий к
заказу. Также указывается информация о данные мест прибытия и отбытия,
данные о водителе (Ф.И.О, дата рождения), выбранные дополнительные опции
и информацию для ваучера.

С помощью этого заказа также можно добавлять новые авто в уже
существующий заказ. Для этого нужно указать id заказа

Запрос, AddOrderRequest
-----------------------

XML-схема запроса:

::

    <?xml version="1.0" encoding="utf-8"?>
    <AddOrderRequest>
      [<ContactInfo> - контактная информация (если заказ еще не создан)
        <Name>..</Name> - имя
        <Email>..</Email> - email
        <Phone>..</Phone> - телефон
        <Comment>..</Comment> - комментарий
      </ContactInfo>]
      [<Tag></Tag>] - референс заказа (нужен только для нового заказа)
      [<OrderId></OrderId>] - id заказа (если авто (несколько авто) нужно добавить в существующий заказ)
      [<AccountComment></AccountComment>] - Комментарий для счета (Если для XML-клиента включено право "Видит комментарий для счета", то это поле для него обязательное.)
      [<Partner>  - Контрагент
        [<PartnerId>...</PartnerId>] - номер контрагента
        [<PartnerBase>...</PartnerBase>] - номер базы контрагента
        [<PartnerName>...</PartnerName>] - имя клиента
      </Partner>] 
      <Items> - элементы заказа
        <VehicleItem> - авто
          <Search
            resultId=".." - id результата в поиске
            searchId=".." - id поиска
          />
          [<PayForm>cash|cashless<PayForm>] - форма оплаты заказа (должна быть одинаковой для всех авто заказа), для существующего заказа указывать необязательно
          <PickUp>
        <PickUpStation>..</PickUpStation> - id станции получения авто
        <PickUpFlightNum>..</PickUpFlightNum> - номер рейса самолёта (если станция поддерживает обслуживание аэропорта)
        <PickUpHotel [hotelId=".."]>
           <HotelInfo [hotelName=".."]
            [hotelAddress=".."]/>
        </PickUpHotel>   
          </PickUp>
          <DropOff>
        <DropOffStation>..</DropOffStation> - id станции возврата авто
          </DropOff>
          <Driver>
          <Title>Mr|Mrs|Ms|Chld</Title> - обращение
          <FirstName>..</FirstName> - имя (латинские)
          <LastName>..</LastName> - фамилия (латинские)
          <BirthDate>..</BirthDate> - дата рождения (YY-mm-dd)
          </Driver>
          <Extras>      
          <Extra>..</Extra> - id дополнительных опций
          </Extras>
          <VoucherInfo>..</VoucherInfo> - информация для ваучера
        </VehicleItem>
      </Items>
    </AddOrderRequest>

Элемент AddOrderRequest
-----------------------

Запрос на создание заказа.

- Корневой элемент.
- Аттрибутов нет.

Дочерние элементы ``AddOrderRequest``:

+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
| **Элемент**        | **Обязательный**                        | **Описание**          |                                            |                                                          |
+====================+=========================================+=======================+============================================+==========================================================+
| ``ContactInfo``    | да для нового заказа                    | Контактная информация |                                            |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**      | **Описание**                               |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``Name``                                | да                    | ф.и.о.                                     |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``Email``                               | да                    | email адрес                                |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``Phone``                               | да                    | телефон (15 символов)                      |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``Comment``                             | да                    | комментарий к заказу (может быть пустым)   |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
| ``Tag``            | да для нового заказа                    | Референс заказа       |                                            |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
| ``OrderId``        | да, если добавляем авто                 | id заказа             |                                            |                                                          |
|                    | в существующий заказ                    |                       |                                            |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
| ``AccountComment`` | да, если для XML-клиента включено право | Комментарий для счета |                                            |                                                          |
|                    | "Видит комментарий для счета"           |                       |                                            |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
| ``Partner``        | нет                                     | Контрагент из ЮТС24   |                                            |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**      | **Описание**                               |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``PartnerId``                           | нет                   | Номер контрагента                          |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``PartnerBase``                         | нет                   | Номер базы                                 |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``PartnerName``                         | нет                   | Имя клиента                                |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
| ``Items``          | да                                      | Элементы заказа       |                                            |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**      | **Описание**                               |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    | ``VehicleItem``                         | да                    | Элемент заказа (может быть много в заказе) |                                                          |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | **Элемент**           | **Обязательный**                           | **Описание**                                             |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | ``Search``            | да                                         | Идентификаторы из результата поиска авто (как аттрибуты) |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | ``PayForm``           | да для нового заказа                       | Форма оплаты                                             |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | ``PickUp``            | да                                         | Параметры места получения                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | ``DropOff``           | да                                         | Параметры места возврата                                 |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | ``Driver``            | да                                         | Водитель (обращение, имя, фамилия, дата рождения)        |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | ``Extras``            | нет                                        | Список выбранных дополнительных опций                    |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+
|                    |                                         | ``VoucherInfo``       | нет                                        | Информация для ваучера                                   |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------+

Элемент ContactInfo
-------------------

Контактная информация с тем, кто бронирует заказ.

- Для нового заказа обязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``ContactInfo``:

+-------------+------------------+-------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                    |
+=============+==================+=================================================+
| ``Name``    | да               | ф.и.о заказчика (максимум 100 символов)         |
+-------------+------------------+-------------------------------------------------+
| ``Email``   | да               | email – адрес заказчика (максимум 100 символов) |
+-------------+------------------+-------------------------------------------------+
| ``Phone``   | да               | телефон заказчика (максимум 15 символов)        |
+-------------+------------------+-------------------------------------------------+
| ``Comment`` | да               | комментарий к заказу (может быть пустым)        |
+-------------+------------------+-------------------------------------------------+

Элемент Tag
-----------

Референс заказа.

- Для нового заказа обязательный элемент.
- Аттрибутов нет.
- Дочерних элементов нет.

Элемент OrderId
---------------

Идентификатор существующего заказа.

- Необходимо указывать в том случае, если Вы желаете добавить авто (несколько авто) в уже созданный ранее заказ.
- Аттрибутов нет.
- Дочерних элементов нет.

Элемент AccountComment
----------------------

Комментарий для счета.

- Необходимо указывать в том случае, если для XML-клиента включено право "Видит комментарий для счета".
- Аттрибутов нет.
- Дочерних элементов нет.

Элемент Partner
---------------
Контрагент из ЮТС24
- *Необязательный элемент*
- *Аттрибутов нет.*

Дочерние элементы ``Partner``:

+-----------------+------------------+-------------------------------------------------+---------------------+
| **Элемент**     | **Обязательный** | **Описание**                                    | **Тип**             |
+=================+==================+=================================================+=====================+
| ``PartnerId``   | нет              | Номер контрагента.                              | Строка (8 символов) |
+-----------------+------------------+-------------------------------------------------+---------------------+
| ``PartnerBase`` | нет              | Номер базы контрагента.                         | Число               |
+-----------------+------------------+-------------------------------------------------+---------------------+
| ``PartnerName`` | нет              | Имя клиента                                     | Имя клиента         |
+-----------------+------------------+-------------------------------------------------+---------------------+


Элемент Items
-------------

Элементы заказа. Авто может быть указано много.

- Обязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``Items``:

+-----------------+------------------+----------------------+----------------------------------------------------------+
| **Элемент**     | **Обязательный** | **Описание**         |                                                          |
+=================+==================+======================+==========================================================+
| ``VehicleItem`` | да               | Элемент заказа       |                                                          |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | **Элемент**      | **Обязательный**     | **Описание**                                             |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | ``Search``       | да                   | Идентификаторы из результата поиска авто (как аттрибуты) |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | ``PayForm``      | да для нового заказа | Форма оплаты                                             |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | ``PickUp``       | да                   | Параметры места получения                                |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | ``DropOff``      | да                   | Параметры места возврата                                 |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | ``Driver``       | да                   | Водитель авто (обращение, имя, фамилия, дата рождения)   |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | ``Extras``       | нет                  | Выбранные дополнительные опции                           |
+-----------------+------------------+----------------------+----------------------------------------------------------+
|                 | ``VoucherInfo``  | нет                  | Информация для ваучера                                   |
+-----------------+------------------+----------------------+----------------------------------------------------------+

Элемент VehicleItem
^^^^^^^^^^^^^^^^^^^

Элемент заказа – авто. Может быть много таких элементов.

- Обязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``VehicleItem``:

+-----------------+------------------+----------------------------------------------------------+
| **Элемент**     | **Обязательный** | **Описание**                                             |
+=================+==================+==========================================================+
| ``Search``      | да               | Идентификаторы из результата поиска авто (как аттрибуты) |
+-----------------+------------------+----------------------------------------------------------+
| ``PayForm``     | нет              | Форма оплаты этого заказа                                |
+-----------------+------------------+----------------------------------------------------------+
| ``PickUp``      | да               | Параметры места получения                                |
+-----------------+------------------+----------------------------------------------------------+
| ``DropOff``     | да               | Параметры места возврата                                 |
+-----------------+------------------+----------------------------------------------------------+
| ``Driver``      | да               | Водитель авто (обращение, имя, фамилия, дата рождения)   |
+-----------------+------------------+----------------------------------------------------------+
| ``Extras``      | нет              | Выбранные дополнительный опции                           |
+-----------------+------------------+----------------------------------------------------------+
| ``VoucherInfo`` | нет              | Информация для ваучера                                   |
+-----------------+------------------+----------------------------------------------------------+

Элемент Search
''''''''''''''

Идентификаторы авто из ответа на поиск авто.

- Обязательный элемент.
- Дочерних элементов нет.

Аттрибуты элемента ``Search``:

+----------------+-----------+--------------------+-------------------------------------------+
| **Аттрибут**   | **Тип**   | **Обязательный**   | **Описание**                              |
+----------------+-----------+--------------------+-------------------------------------------+
| ``resultId``   | число     | да                 | id результата из поиска                   |
+----------------+-----------+--------------------+-------------------------------------------+
| ``searchId``   | число     | да                 | id поиска, из которого указан результат   |
+----------------+-----------+--------------------+-------------------------------------------+

Элемент PayForm
'''''''''''''''

Форма оплаты.

- Допустимые значения: cash (наличная форма оплаты), cashless (безналичная форма).
- Необязательный элемент. По умолчанию - наличная форма оплаты (cash)
- Дочерних элементов нет.
- Аттрибутов элемента нет.

Элемент PickUp
''''''''''''''

Параметры места получения авто.

- Обязательный элемент.
- Аттрибутов элемента нет.

Дочерние элементы:

+-----------------------+-----------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+
| **Элемент**           | **Тип**                                                         | **Обязательный**   | **Описание**                                                                   |
+-----------------------+-----------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+
| ``PickUpStation``     | число                                                           | да                 | id станции получения                                                           |
+-----------------------+-----------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+
| ``PickUpFlightNum``   | строка                                                          | да                 | номер рейса (если станция обслуживает аэропорты)                               |
+-----------------------+-----------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+
| ``PickUpHotel``       | Элемент, содержащий id или же название и адрес отеля доставки   | нет                | информация об отеле доставки авто, если данная опция поддерживается станцией   |
+-----------------------+-----------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+

Элемент PickUpHotel
'''''''''''''''''''

Параметры отеля доставки (если данная опция поддерживается станцией получения авто).

- Необязательный элемент.

Аттрибуты элемента ``PickUpHotel``:

+----------------+-----------+--------------------+--------------------------+
| **Аттрибут**   | **Тип**   | **Обязательный**   | **Описание**             |
+----------------+-----------+--------------------+--------------------------+
| ``hotelId``    | число     | да                 | id отеля доставки авто   |
+----------------+-----------+--------------------+--------------------------+

Дочерние элементы:

+-----------------+----------------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+
| **Элемент**     | **Тип**                                                              | **Обязательный**   | **Описание**                                                                   |
+-----------------+----------------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+
| ``HotelInfo``   | Элемент, содержащий, как атрибуты, название и адрес отеля доставки   | нет                | информация об отеле доставки авто, если данная опция поддерживается станцией   |
+-----------------+----------------------------------------------------------------------+--------------------+--------------------------------------------------------------------------------+

Элемент HotelInfo
'''''''''''''''''

Параметры отеля доставки (если данная опция поддерживается станцией получения авто).

- Необязательный элемент.
- Дочерних элементов нет.

Аттрибуты элемента ``HotelInfo``:

+--------------------+-----------+--------------------+--------------------------------+
| **Аттрибут**       | **Тип**   | **Обязательный**   | **Описание**                   |
+--------------------+-----------+--------------------+--------------------------------+
| ``hotelName``      | строка    | да                 | Название отеля доставки авто   |
+--------------------+-----------+--------------------+--------------------------------+
| ``hotelAddress``   | строка    | да                 | Адрес отеля доставки авто      |
+--------------------+-----------+--------------------+--------------------------------+

Элемент DropOff
'''''''''''''''

Параметры места возврата авто.

- Обязательный элемент.
- Аттрибутов элемента нет.

Дочерние элементы:

+----------------------+-----------+--------------------+-----------------------+
| **Элемент**          | **Тип**   | **Обязательный**   | **Описание**          |
+----------------------+-----------+--------------------+-----------------------+
| ``DropOffStation``   | число     | да                 | id станции возврата   |
+----------------------+-----------+--------------------+-----------------------+

Элемент Driver
''''''''''''''

Водитель авто.

- Обязательный элемент.
- Аттрибутов элемента нет.

Дочерние элементы:

+---------------+----------------+------------------+---------------------------------------+
| **Элемент**   | **Тип**        | **Обязательный** | **Описание**                          |
+===============+================+==================+=======================================+
| ``Title``     | Mr,Ms,Mrs,Chld | да               | обращение                             |
+---------------+----------------+------------------+---------------------------------------+
| ``FirstName`` | строка         | да               | имя водителя (латинскими буквами)     |
+---------------+----------------+------------------+---------------------------------------+
| ``LastName``  | строка         | да               | фамилия водителя (латинскими буквами) |
+---------------+----------------+------------------+---------------------------------------+
| ``BirthDate`` | строка         | да               | дата рождения водителя (YY-mm-dd)     |
+---------------+----------------+------------------+---------------------------------------+

Элемент Extras
''''''''''''''

Список выбранных дополнительных опций.

- Необязательный элемент.
- Аттрибутов элемента нет.

Дочерние элементы:

+---------------+-------------------------------------------------------------+--------------------+----------------+
| **Элемент**   | **Тип**                                                     | **Обязательный**   | **Описание**   |
+---------------+-------------------------------------------------------------+--------------------+----------------+
| ``Extra``     | id дополнительной опции, таких элементов может быть много   | да                 |                |
+---------------+-------------------------------------------------------------+--------------------+----------------+

Элемент VoucherInfo
'''''''''''''''''''

Информация для ваучера.

- Необязательный элемент.
- Аттрибутов элемента нет.
- Дочерних элементов нет

Ответ на создание заказа, AddOrderResponse
------------------------------------------

XML-схема ответа:

::

    <?xml version="1.0" encoding="utf-8"?>
    <AddOrderResponse>
      [<Errors>
        <Error code="..." description="..."> - ошибки
      </Errors>]
      [<OrderId>..</OrderId>] - id созданного заказа
    </AddOrderResponse>

Элемент AddOrderResponse
------------------------

Ответ, сформированный сервером на добавление заказа **AddOrderRequest**.

- Корневой элемент.
- Аттрибутов нет.
- Дочерние элементы ``AddOrderResponse``:

+-------------+------------------+--------------------------+
| **Элемент** | **Обязательный** | **Описание**             |
+=============+==================+==========================+
| ``Errors``  | нет              | Список ошибок, если есть |
+-------------+------------------+--------------------------+

+-------------+------------------+-------------------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                                |
+=============+==================+=============================================================+
| ``Error``   | да               | Описание ошибки (и код), ошибок может быть много            |
+-------------+------------------+-------------------------------------------------------------+
| ``OrderId`` | нет              | Id созданного заказа, если удалось создать (не было ошибок) |
+-------------+------------------+-------------------------------------------------------------+

Элемент Errors
~~~~~~~~~~~~~~

Смотри страницу :doc:`Ошибки <../errors>`

Элемент OrderId
~~~~~~~~~~~~~~~

Id нового заказа, если его удалось создать (в том случае, если не было ошибок).

- Необязательный элемент.
- Аттрибутов нет.
- Дочерних элементов нет.

