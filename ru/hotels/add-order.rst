Создание заказа или добавление нового отеля
###########################################

Описание XML схемы
==================

XSD-схемы для создания заказа или добавления нового отеля:

-  ``www/xsd/AddOrderRequest.xsd``
-  ``www/xsd/AddOrderResponse.xsd``

После того, как был произведён поиск отелей, можно создать заказ, с
одним или несколькими отелями. При создании заказа указываются
контактная информация: ф.и.о., email адрес, телефон и если нужно
комментарий к заказу. Также указывается информация по персонам в
номерах. На каждый номер указывается строгое число людей, при этом
ребёнок, если таковой есть в номере – идёт последним.
С помощью этого заказа также можно добавлять новые отели в уже существующий заказ. Для этого нужно указать id заказа

Запрос, AddOrderRequest
-----------------------

XML-схема запроса:

.. code-block:: xml

  <?xml version="1.0" encoding="utf-8"?>
    <AddOrderRequest>
      [<ContactInfo> - контактная информация (если заказ еще не создан)
        <Name>..</Name> - имя
        <Email>..</Email> - email
        <Phone>..</Phone> - телефон
        <Comment>..</Comment> - комментарий
      </ContactInfo>]
      [<Tag></Tag>] - референс заказа (нужен только для нового заказа)
      [<OrderId></OrderId>] - id заказа (если отель (отели) нужно добавить в существующий заказ)
      [<AccountComment></AccountComment>] - Комментарий для счета (Если для XML-клиента включено право "Видит комментарий для счета", то это поле для него обязательное.)
      [<Items> - элементы заказа
        <HotelItem> - отель
          <Search
            resultId=".." - id результата в поиске
            searchId=".." - id поиска
          />
          [<DuplicatesAllowed>true|false<DuplicatesAllowed>] - допускаются ли дубликаты для этого отеля
          [<PayForm>cash|cashless<PayForm>] - форма оплаты заказа (должна быть одинаковой для всех отелей заказа), для существующего заказа указывать необязательно
          <Rooms> - комнаты, в порядке, в котором были переданы в ответе на поиск отелей
            <Room>
              <RoomPax [child="true|false"] [age=".."]> - люди в номере
                <Title>Mr|Mrs|Ms|Chld</Title> - обращение
                <FirstName>..</FirstName> - имя (латинские)
                <LastName>..</LastName> - фамилия (латинские)
              </RoomPax>
            </Room>
          </Rooms>
          <Remarks> - список ремарок (необязательный элемент)
             <Remark>код ремарки</Remark> - таких ремарок может быть несколько
          </Remarks>
          <Comment>...</Comment> - свободная ремарка (необязательный элемент)
        </HotelItem>
      </Items>
    </AddOrderRequest>


Элемент AddOrderRequest
-----------------------

Запрос на создание заказа.

- *Корневой элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``AddOrderRequest``:

+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
| **Элемент**        | **Обязательный**                        | **Описание**                            |                                                           |                                                            |
+====================+=========================================+=========================================+===========================================================+============================================================+
| ``ContactInfo``    | да для нового заказа                    | Контактная информация                   |                                                           |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**                        | **Описание**                                              |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    | ``Name``                                | да                                      | ф.и.о.                                                    |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    | ``Email``                               | да                                      | email адрес                                               |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    | ``Phone``                               | да                                      | телефон (15 символов)                                     |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    | ``Comment``                             | да                                      | комментарий к заказу (может быть пустым)                  |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
| ``Tag``            | да для нового заказа                    | Референс заказа                         |                                                           |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
| ``OrderId``        | да, если добавляем отель                | id заказа                               |                                                           |                                                            |
|                    | в существующий заказ                    |                                         |                                                           |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
| ``AccountComment`` | да, если для XML-клиента включено право | Комментарий для счета                   |                                                           |                                                            |
|                    | "Видит комментарий для счета"           |                                         |                                                           |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
| ``Items``          | да                                      | Элементы заказа (пока что только отели) |                                                           |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**                        | **Описание**                                              |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    | ``HotelItem``                           | да                                      | Элемент заказа – отель (может быть много отелей в заказе) |                                                            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    |                                         | **Элемент**                             | **Обязательный**                                          | **Описание**                                               |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    |                                         | ``Search``                              | да                                                        | Идентификаторы из результата поиска отелей (как аттрибуты) |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    |                                         | ``PayForm``                             | да для нового заказа                                      | Форма оплаты                                               |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+
|                    |                                         | ``Rooms``                               | да                                                        | Информация по комнатам (дочерние элементы Room)            |
+--------------------+-----------------------------------------+-----------------------------------------+-----------------------------------------------------------+------------------------------------------------------------+

Элемент ContactInfo
-------------------

Контактная информация с тем, кто бронирует заказ.

- *Для нового заказа обязательный элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``ContactInfo``:

+-------------+------------------+-------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                    |
+=============+==================+=================================================+
| ``Name``    | да               | ф.и.о заказчика (максимум 100 символов)         |
+-------------+------------------+-------------------------------------------------+
| ``Email``   | да               | email – адрес заказчика (максимум 100 символов) |
+-------------+------------------+-------------------------------------------------+
| ``Phone``   | да               | телефон заказчика (максимум 15 символов)        |
+-------------+------------------+-------------------------------------------------+
| ``Comment`` | да               | комментарий к заказу (может быть пустым)        |
+-------------+------------------+-------------------------------------------------+

Элемент Tag
-----------

Референс заказа.

- *Для нового заказа обязательный элемент.*
- *Аттрибутов нет.*
- *Дочерних элементов нет.*

Элемент OrderId
---------------

Идентификатор существующего заказа.

- *Необходимо указывать в том случае, если Вы желаете добавить отель (отели) в уже созданный ранее заказ.*
- *Аттрибутов нет.*
- *Дочерних элементов нет.*

Элемент AccountComment
----------------------

Комментарий для счета.

- *Необходимо указывать в том случае, если для XML-клиента включено право "Видит комментарий для счета".*
- *Аттрибутов нет.*
- *Дочерних элементов нет.*

Элемент Items
-------------

Элементы заказа. Пока что только отели. Отелей может быть указано много.

- *Обязательный элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``Items``:

+---------------+------------------+-----------------------------------------------------------+------------------------------------------------------------+
| **Элемент**   | **Обязательный** | **Описание**                                              |                                                            |
+===============+==================+===========================================================+============================================================+
| ``HotelItem`` | да               | Элемент заказа – отель (может быть много отелей в заказе) |                                                            |
+---------------+------------------+-----------------------------------------------------------+------------------------------------------------------------+
|               | **Элемент**      | **Обязательный**                                          | **Описание**                                               |
+---------------+------------------+-----------------------------------------------------------+------------------------------------------------------------+
|               | ``Search``       | да                                                        | Идентификаторы из результата поиска отелей (как аттрибуты) |
+---------------+------------------+-----------------------------------------------------------+------------------------------------------------------------+
|               | ``Rooms``        | да                                                        | Информация по комнатам (дочерние элементы Room)            |
+---------------+------------------+-----------------------------------------------------------+------------------------------------------------------------+

Элемент HotelItem
-----------------

Элемент заказа – отель. Может быть много таких элементов.

- *Обязательный элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``HotelItem``:

+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
| **Элемент**             | **Обязательный** | **Описание**                                               |                                                                    |                              |
+=========================+==================+============================================================+====================================================================+==============================+
| ``Search``              | да               | Идентификаторы из результата поиска отелей (как аттрибуты) |                                                                    |                              |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
| ``AlternativesAllowed`` | нет              | Устаревшая опция. Допускается только значение 'false'      |                                                                    |                              |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
| ``DuplicatesAllowed``   | нет              | Допускаются ли для этого отеля дубликаты                   |                                                                    |                              |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
| ``PayForm``             | нет              | Форма оплаты этого заказа                                  |                                                                    |                              |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
| ``Rooms``               | да               | Информация по комнатам (дочерние элементы Room)            |                                                                    |                              |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
|                         | **Элемент**      | **Обязательный**                                           | **Описание**                                                       |                              |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
|                         | ``Room``         | да                                                         | Номера отеля, в порядке, в котором пришли в ответе на поиске отеля |                              |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
|                         |                  | **Элемент**                                                | **Обязательный**                                                   | **Описание**                 |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+
|                         |                  | ``RoomPax``                                                | да                                                                 | Информация по людям в номере |
+-------------------------+------------------+------------------------------------------------------------+--------------------------------------------------------------------+------------------------------+

Элемент Search
--------------

Идентификаторы отеля из ответа на поиск отелей.

- *Обязательный элемент.*
- *Дочерних элементов нет.*

Аттрибуты элемента ``Search``\:

+--------------+---------+------------------+-----------------------------------------+
| **Аттрибут** | **Тип** | **Обязательный** | **Описание**                            |
+==============+=========+==================+=========================================+
| ``resultId`` | число   | да               | id результата из поиска                 |
+--------------+---------+------------------+-----------------------------------------+
| ``searchId`` | число   | да               | id поиска, из которого указан результат |
+--------------+---------+------------------+-----------------------------------------+

Элемент AlternativesAllowed
---------------------------

Устаревшая опция. Допускается только значение 'false'

- *Дочерних элементов нет.*
- *Аттрибутов элемента нет.*

Элемент DuplicatesAllowed
-------------------------

Допускаются ли дубликаты заказа. Допустимые значения: true, false
Дубликатом считается заказ, в котором забронирован тот же отель, на те
же даты заезда/выезда, для тех же клиентов и по тому же внутреннему
поставщику. Если такой заказ найден, система вернет ошибку с кодом
"E301" ("Similar booking already exists"). Для некоторых отелей
дубликаты не разрешаются. Потому даже при установке этого флажка в true
вернется ошибка E301.

- *Необязательный элемент. По умолчанию - false (не допускаются)*
- *Дочерних элементов нет.*
- *Аттрибутов элемента нет.*

Элемент PayForm
---------------

Форма оплаты.

- *Допустимые значения: cash (наличная форма оплаты), cashless (безналичная форма).*
- *Необязательный элемент. По умолчанию - наличная форма оплаты (cash)*
- *Дочерних элементов нет.*
- *Аттрибутов элемента нет.*

Элемент Rooms
-------------

Номера с информаций о людях, строго в порядке, в котором были переданы в ответе на поиск отелей по этому ``resultId``.

- *Обязательный элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``Rooms``\:

+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                                    |                                                                 |                                            |
+=============+==================+=================================================================+=================================================================+============================================+
| ``Room``    | да               | Номера с информацией о людях (таких элементов может быть много) |                                                                 |                                            |
+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+
|             | **Элемент**      | **Обязательный**                                                | **Описание**                                                    |                                            |
+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+
|             | ``RoomPax``      | да                                                              | Информация по людям в номере (таких элементов может быть много) |                                            |
+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+
|             |                  | **Элемент**                                                     | **Обязательный**                                                | **Описание**                               |
+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+
|             |                  | ``Title``                                                       | да                                                              | Обращение к персоне (Mr / Mrs / Ms / Chld) |
+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+
|             |                  | ``FirstName``                                                   | да                                                              | Имя персоны                                |
+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+
|             |                  | ``LastName``                                                    | да                                                              | Фамилия персоны                            |
+-------------+------------------+-----------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------------+

Элемент RoomPax
---------------

Информация о персоне в номере. Если в номере есть ребёнок, то он должен идти последним в списке Room! Указывать информацию о младенцах не нужно 

- *Обязательный элемент.*

Аттрибуты элемента ``RoomPax``\:

+--------------+---------+------------------+------------------------------------------------------------------------------------------------------------------------------+
| **Аттрибут** | **Тип** | **Обязательный** | **Описание**                                                                                                                 |
+==============+=========+==================+==============================================================================================================================+
| ``child``    | логич.  | нет              | true – если это ребёнок (в этом случае элемент RoomPax должен быть последним в элементе Room)                                |
+--------------+---------+------------------+------------------------------------------------------------------------------------------------------------------------------+
| ``age``      | число   | нет              | возраст ребёнка (2–18), должен присутствовать, если аттрибут child=true. Если указан возраст меньше 3, система вернет ошибку |
+--------------+---------+------------------+------------------------------------------------------------------------------------------------------------------------------+

Дочерние элементы ``RoomPax``\:

+---------------+------------------+--------------------------------------------+
| **Элемент**   | **Обязательный** | **Описание**                               |
+===============+==================+============================================+
| ``Title``     | да               | Обращение к персоне (Mr / Mrs / Ms / Chld) |
+---------------+------------------+--------------------------------------------+
| ``FirstName`` | да               | Имя персоны                                |
+---------------+------------------+--------------------------------------------+
| ``LastName``  | да               | Фамилия персоны                            |
+---------------+------------------+--------------------------------------------+

**Внимание:** *Элемент ``FullName`` сейчас необязательный и будет удален с 01.01.2013*

Элемент Remarks
---------------

Список ремарок.

- *Необязательный элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``Remarks``\:

+-------------+------------------+---------------------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                                  |
+=============+==================+===============================================================+
| ``Remark``  | да               | Код ремарки - например, LA (таких элементов может быть много) |
+-------------+------------------+---------------------------------------------------------------+

Элемент Remark
--------------

Код ремарки.

- *Аттрибутов нет.*
- *Дочерних элементов нет.*

Список всех доступных кодов ремарок можно получить по запросу ``/xml/remark``. 
Код ремарки находится в атрибуте Remark@temp ответа. Список ремарок, допустимых для данного предложения можно получить по запросу ``/xml/hotel_modify_restrictions?search_id=[id_поиска]&result_id=[id_предложения]``.
Коды допустимых ремарок находятся в ``Hotel/PossibleRemarks/Remark@code``

Элемент Comment
---------------

Свободная ремарка. Допускаются комментарии на английском языке.

- *Необязательный элемент.*
- *Аттрибутов нет.*
- *Дочерних элементов нет.*

Ответ на создание заказа, AddOrderResponse
------------------------------------------

XML-схема ответа:

.. code-block:: xml

  <?xml version="1.0" encoding="utf-8"?>
    <AddOrderResponse>
      [<Errors>
        <Error code="..." description="..."> - ошибки 
      </Errors>]
      [<OrderId>..</OrderId>] - id созданного заказа
    </AddOrderResponse>

Элемент AddOrderResponse
------------------------

Ответ, сформированный сервером на добавление заказа **AddOrderRequest**.

- *Корневой элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``AddOrderResponse``\:

+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                                |                                                  |
+=============+==================+=============================================================+==================================================+
| ``Errors``  | нет              | Список ошибок, если есть                                    |                                                  |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
|             | **Элемент**      | **Обязательный**                                            | **Описание**                                     |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
|             | ``Error``        | да                                                          | Описание ошибки (и код), ошибок может быть много |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
| ``OrderId`` | нет              | Id созданного заказа, если удалось создать (не было ошибок) |                                                  |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+

Элемент Errors
--------------

Список ошибок (дочерние элементы ``Error``).

- *Необязательный элемент.*
- *Аттрибутов нет.*

Дочерние элементы ``Errors``\:

+-------------+------------------+---------------------------------------------------------------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                                                                            |
+=============+==================+=========================================================================================================+
| ``Error``   | да               | Код ошибки(``code``) и описание ошибки(``description``) как аттрибуты элемента. Ошибок может быть много |
+-------------+------------------+---------------------------------------------------------------------------------------------------------+

Элемент Error
-------------

Код и расшифровка ошибки.

- *Обязательный элемент.*
- *Дочерних элементов нет.*

Аттрибуты элемента ``Error``\:

+--------------+---------+------------------+-----------------+
| **Аттрибут** | **Тип** | **Обязательный** | **Описание**    |
+==============+=========+==================+=================+
| code         | строка  | да               | Код ошибки UTS. |
+--------------+---------+------------------+-----------------+
| description  | строка  | да               | Описание ошибки |
+--------------+---------+------------------+-----------------+

Элемент OrderId
---------------

Id нового заказа, если его удалось создать (в том случае, если не было ошибок).

- *Необязательный элемент.*
- *Аттрибутов нет.*
- *Дочерних элементов нет.*