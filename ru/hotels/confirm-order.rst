Подтверждение заказа
####################

Описание XML схемы подтверждения заказа
=======================================

Запрос на подтверждение заказа сейчас формируется через URL(методом GET).

XSD-схема ответа после подтверждения заказа:

- ``www/xsd/ConfirmOrderResponse.xsd``

Запрос на подтверждение заказа
------------------------------

В запросе должен быть один параметр – ``order_id``, взятый из ответа на создание заказа. Сейчас он передаётся через URL вместе с учётными данными(``login``, ``password``, ``checksum``,..).

Запрос формируется по пути: ``/xml/confirm_order``

XML-схема ответа на запрос подтверждения заказа, ConfirmOrderResponse
---------------------------------------------------------------------

.. code-block:: xml

    <?xml version="1.0" encoding="utf-8"?>

        <ConfirmOrderResponse>
         [<Errors>
            <Error code="..." description="..."> - ошибки
          </Errors>]
          <Order>

            <Id>...</Id> - идентификатор заказа
            <Tag>...</Tag> - референс заказа
            <State>...</State> - состояние заказа
            <Paxes>

              <Pax paxId="..." child="true|false"> - данные о каждой персоне в заказе
                <Title>...</Title>

                <FirstName>...</FirstName>

                <LastName>...</LastName>
               [<FullName>...</FullName>]
              </Pax>

            </Paxes>
            <Items>

              <HotelItem itemId="40036"> - элемент заказа (отель)
                <HotelId>...</HotelId> - идентификатор отеля
                <CityId>...</CityId> - идентификатор города
                <Name>...</Name> - название отеля
                <CategoryId>...</CategoryId> - категория отеля
                <State>...</State> - состояние элемента заказа
                <CheckIn>...</CheckIn> - дата заезда
                <Duration>...</Duration> - длительность заезда
                <TotalPrice>...</TotalPrice>
                <ExtraPrice currency="USD" >...</ExtraPrice>
                <Currency>...</Currency>
                <HotelPaid>true|false</HotelPaid>
                <UseNds>true|false</UseNds>
                <SpecialOfferText>...</SpecialOfferText>
                <ProviderId>...</ProviderId> - идентификатор поставщика
                <Rooms>

                  <Room
                     roomName="..."
                     mealId="..." mealName="..."

                     mealBreakfastId="..." mealBreakfastName="..."
                     child="0|1" cots="0|1|2" sharingBedding="true|false"

                     >
                     <Paxes> - список персон в номере
                       <PaxId>...</PaxId>
                     </Paxes>
                  </Room>

                </Rooms>

                <Remarks> - ремарки заказа
                  [<Remark>...</Remark>]
                </Remarks>
                <ChargeConditions>

                  <Currency>..</Currency> - валюта штрафов
                  <Cancellations> - штрафы при отмене
                    <Cancellation - может быть несколько таких элементов

                      charge="true|false" - есть ли штраф

                      [from="2008-02-28T11:50:00"] - штраф действует от этой даты
                      [to="2008-02-28T11:50:00"] - и до этой

                      [price="100.00"] - цена в валюте Currency (элемент присутствует только если charge=true)
                      [policy="1 ночь"] - политика штрафа

                    />
                  </Cancellations>
                  <Amendments> - штрафы при изменении
                    <Amendment - может быть несколько таких элементов
                      charge="true|false"

                      [from="YYYY-MM-DDThh:ii:ss"]
                      [to="YYYY-MM-DDThh:ii:ss"]
                      [price=".."]

                      [policy=".."]

                    />
                  </Amendments>
                </ChargeConditions>

                <PriceDetails> - разбивки цен
                  <Currency>..</Currency> - валюта цен
                 [<Discount>..</Discount>] - скидка от поставщика
                 [<Offer>..</Offer>] - текст предложения(скидки) от поставщика
                  <RoomPrices>

                    <Room - может быть несколько таких элементов
                      roomNumber=".." - число комнат
                      roomName="..."
                      child="0|1" - количество детей

                     [cots="1|2"] - количество люлек (если нет - не будет и аттрибута)
                      >
                      <Price - может быть несколько таких элементов

                        date="YYYY-MM-DD"

                        available="true|false" - доступна ли разбивка
                        price=".." - цена

                       [priceChild=".."] - цена на детей

                       [priceCot=".."] - цена на люльки

                      />
                    </Room>
                  </RoomPrices>
                </PriceDetails>

              </HotelItem>

            </Items>
            <ContactInfo> -  контактная информация заказчика
              <Name>...</Name>
              <Email>...</Email>

              <Phone>...</Phone>
              <Comment>...</Comment>
            </ContactInfo>
          </Order>
        </ConfirmOrderResponse>

Элемент ConfirmOrderResponse
----------------------------

Информация о подтвержденном заказе

- *Корневой элемент.*
- *Атрибуты: нет.*

Дочерние элементы:

+--------+-------------------------------------+--------------------------+
| Имя    | Обязательный                        | Описание                 |
+========+=====================================+==========================+
| Errors | Нет                                 | Список ошибок, если есть |
+--------+-------------------------------------+--------------------------+
| Order  | Нет (отсутствует, если были ошибки) | Информация о заказе      |
+--------+-------------------------------------+--------------------------+

Элемент Errors
--------------

Список найденных отелей.

- *Атрибуты: нет.*

Дочерние элементы:

+-------+--------------+-------------------------------------+
| Имя   | Обязательный | Описание                            |
+=======+==============+=====================================+
| Error | Да           | Описание ошибки.                    |
|       |              | Атрибуты:                           |
|       |              | - ``code`` - код ошибки             |
|       |              | - ``description`` - описание ошибки |
+-------+--------------+-------------------------------------+

Элемент Order
-------------

Описание заказа.

- *Атрибуты: нет.*

Дочерние элементы:

+-------------+----------------------+--------------+---------------------------------------------------------+
| Имя         | Тип                  | Обязательный | Описание                                                |
+=============+======================+==============+=========================================================+
| Id          | Число                | Да           | Идентификатор заказа                                    |
+-------------+----------------------+--------------+---------------------------------------------------------+
| Tag         | Строка               | Да           | Референс заказа                                         |
+-------------+----------------------+--------------+---------------------------------------------------------+
| State       | Строка               | Да           | Состояние заказа (новый, измененный, подтвержденый)     |
+-------------+----------------------+--------------+---------------------------------------------------------+
| Paxes       | Список элементов Pax | Да           | Список персон в заказе                                  |
+-------------+----------------------+--------------+---------------------------------------------------------+
| Items       | Список элементов     | Да           | Список элементов заказа, пока только отелей (HotelItem) |
+-------------+----------------------+--------------+---------------------------------------------------------+
| ContactInfo | Вложенные элементы   | Да           | Контактная информация заказчика                         |
+-------------+----------------------+--------------+---------------------------------------------------------+

Элемент Order/Paxes
-------------------

Список персон в заказе

- *Атрибуты: нет.*

Дочерние элементы:

+-----+--------------+----------------------+
| Имя | Обязательный | Описание             |
+=====+==============+======================+
| Pax | Да           | Информация о персоне |
+-----+--------------+----------------------+

Элемент Order/Paxes/Pax
-----------------------

Информация о персоне.

Атрибуты:

+-------+----------------+--------------+------------------------+
| Имя   | Тип            | Обязательный | Описание               |
+=======+================+==============+========================+
| paxId | Число          | Да           | id персоны             |
+-------+----------------+--------------+------------------------+
| child | true или false | Да           | Если true, это ребенок |
+-------+----------------+--------------+------------------------+

Дочерние элементы:

+-----------+-------------------+--------------+------------------------------------------------------------------+
| Имя       | Тип               | Обязательный | Описание                                                         |
+===========+===================+==============+==================================================================+
| Title     | Mr, Mrs, Ms, Chld | Да           | Обращение к персоне                                              |
+-----------+-------------------+--------------+------------------------------------------------------------------+
| FirstName | Строка            | Да           | Имя персоны                                                      |
+-----------+-------------------+--------------+------------------------------------------------------------------+
| LastName  | Строка            | Да           | Фамилия персоны                                                  |
+-----------+-------------------+--------------+------------------------------------------------------------------+
| FullName  | Строка            | Да           | Полное имя персоны (обращение + фамилия + имя), можно на русском |
+-----------+-------------------+--------------+------------------------------------------------------------------+

Элемент Order/Items/HotelItem
-----------------------------

Список номеров отеля.

Атрибуты:

+--------+-------+--------------+-------------------------------+
| Имя    | Тип   | Обязательный | Описание                      |
+========+=======+==============+===============================+
| itemId | Число | Да           | Идентификатор элемента заказа |
+--------+-------+--------------+-------------------------------+

Дочерние элементы:

+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| Имя              | Тип                         | Обязательный | Описание                                                                    |
+==================+=============================+==============+=============================================================================+
| HotelId          | Число                       | Да           | id отеля                                                                    |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| CityId           | Число                       | Да           | id города, где находится отель                                              |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| Name             | Строка                      | Да           | Название отеля                                                              |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| CategoryId       | Число                       | Да           | id категории звездности отеля из списка категорий                           |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| State            | Число                       | Да           | Состояние элемента заказа (новый, в обработке, подтвержден, отменен и т.д.) |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| CheckIn          | Дата в формате "YYYY-MM-DD" | Да           | Дата заезда                                                                 |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| Duration         | Число                       | Да           | Длительность заезда (дни)                                                   |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| TotalPrice       | Число                       | Да           | Цена                                                                        |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| ExtraPrice       | Число                       | Да           | Дополнительная наценка поставщика                                           |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| Currency         | строка                      | Да           | Валюта отеля                                                                |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| HotelPaid        | true или false              | Да           | Заплачено или нет                                                           |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| UseNds           | true или false              | Нет          | Включен или нет НДС. Если отсутствует - не облагается налогом               |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| SpecialOfferText | Строка                      | Да           | Специальное предложение отеля                                               |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| ProviderId       | Число                       | Да           | id поставщика, давшего информацию об отеле                                  |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| Rooms            | Список элементов Room       | Да           | Список номеров, заказанных в отеле                                          |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| Remarks          | Список элементов Remark     | Да           | Список ремарок заказа                                                       |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| ChargeConditions | Вложенные элементы          | Нет          | Список штрафов                                                              |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+
| PriceDetails     | Вложенные элементы          | Нет          | Разбивка цен                                                                |
+------------------+-----------------------------+--------------+-----------------------------------------------------------------------------+

Элемент Order/Items/HotelItem/Rooms/Room
----------------------------------------

Описание номера отеля.

Атрибуты:

+-------------------+-----------------+--------------+------------------------------------------------------------+
| Имя               | Тип             | Обязательный | Описание                                                   |
+===================+=================+==============+============================================================+
| roomName          | Строка          | Да           | Название номера (размер, тип, вид)                         |
+-------------------+-----------------+--------------+------------------------------------------------------------+
| mealId            | Число           | Да           | Идентификатор типа питания из списка типов питания         |
+-------------------+-----------------+--------------+------------------------------------------------------------+
| mealName          | Строка          | Да           | Название типа питания                                      |
+-------------------+-----------------+--------------+------------------------------------------------------------+
| mealBreakfastId   | Число           | Да           | Идентификатор типа завтрака из списка завтраков            |
+-------------------+-----------------+--------------+------------------------------------------------------------+
| mealBreakfastName | Строка          | Да           | Название типа завтрака                                     |
+-------------------+-----------------+--------------+------------------------------------------------------------+
| child             | 0 или 1         | Да           | Есть ли в номере дополнительное место для ребенка          |
+-------------------+-----------------+--------------+------------------------------------------------------------+
| cots              | Чсило от 0 до 2 | Да           | Количество люлек в номере                                  |
+-------------------+-----------------+--------------+------------------------------------------------------------+
| sharingBedding    | true или false  | Да           | Разделение постельных принадлежностей на двоих (если true) |
+-------------------+-----------------+--------------+------------------------------------------------------------+

Дочерние элементы:

+-------+--------------+----------------------------------------------------------------------------+
| Имя   | Обязательный | Описание                                                                   |
+=======+==============+============================================================================+
| Paxes | Да           | Список персон в номере - список элементов PaxId, взятых из Order/Paxes/Pax |
+-------+--------------+----------------------------------------------------------------------------+

Элемент Order/Items/HotelItem/Remarks
-------------------------------------

Список ремарок заказа.

- *Атрибуты: нет.*

Дочерние элементы:

+--------+--------+--------------+-------------+
| Имя    | Тип    | Обязательный | Описание    |
+========+========+==============+=============+
| Remark | Строка | Нет          | Код ремарки |
+--------+--------+--------------+-------------+

Элемент Order/Items/HotelItem/ChargeConditions
----------------------------------------------

Штрафы при отмене и изменении брони

- *Атрибуты: нет.*

Дочерние элементы:

+---------------+--------------+------------------------------+
| Имя           | Обязательный | Описание                     |
+===============+==============+==============================+
| Currency      | Да           | Валюта штрафов               |
+---------------+--------------+------------------------------+
| Cancellations | Да           | Список штрафов при отмене    |
+---------------+--------------+------------------------------+
| Amendments    | Нет          | Список штрафов при изменении |
+---------------+--------------+------------------------------+

Элемент Order/Items/HotelItem/ChargeConditions/Cancellation
-----------------------------------------------------------

Список штрафов при отмене.

Атрибуты:

+--------+----------------+--------------+---------------------------------------------------------------------------------+
| Имя    | Тип            | Обязательный | Описание                                                                        |
+========+================+==============+=================================================================================+
| charge | true или false | Да           | Есть штраф(true), или нет(false)                                                |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| from   | Дата           | Нет          | Дата и время начала действия штрафа                                             |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| to     | Дата           | Нет          | Дата и время окончания действия штрафа                                          |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| price  | Число          | Нет          | Цена в валюте Currency (аттрибут будет присутствовать только если charge=true)  |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| policy | Строка         | Нет          | Политика штрафа (иногда вместо цены может указывать политика, например «1 ночь» |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| charge | true или false | Да           | есть штраф(true), или нет(false)                                                |
+--------+----------------+--------------+---------------------------------------------------------------------------------+

Дочерние элементы: нет.

Элемент Order/Items/HotelItem/ChargeConditions/Amendment
--------------------------------------------------------

Список штрафов при изменении.

Атрибуты:

+--------+----------------+--------------+---------------------------------------------------------------------------------+
| Имя    | Тип            | Обязательный | Описание                                                                        |
+========+================+==============+=================================================================================+
| charge | true или false | Да           | Есть штраф(true), или нет(false)                                                |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| from   | Дата           | Нет          | Дата и время начала действия штрафа                                             |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| to     | Дата           | Нет          | Дата и время окончания действия штрафа                                          |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| price  | Число          | Нет          | Цена в валюте Currency (аттрибут будет присутствовать только если charge=true)  |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| policy | Строка         | Нет          | Политика штрафа (иногда вместо цены может указывать политика, например «1 ночь» |
+--------+----------------+--------------+---------------------------------------------------------------------------------+
| charge | true или false | Да           | есть штраф(true), или нет(false)                                                |
+--------+----------------+--------------+---------------------------------------------------------------------------------+

- *Дочерние элементы: нет.*

Элемент Order/Items/HotelItem/PriceDetails
------------------------------------------

Разбивка цен по комнатам.

- *Атрибуты: нет.*

Дочерние элементы:

+------------+-----------------------+--------------+------------------------------------------+
| Имя        | Тип                   | Обязательный | Описание                                 |
+============+=======================+==============+==========================================+
| Currency   | Строка                | Да           | Валюта цен                               |
+------------+-----------------------+--------------+------------------------------------------+
| Discount   | Число                 | Нет          | Скидка от поставщика                     |
+------------+-----------------------+--------------+------------------------------------------+
| Offer      | Строка                | Нет          | Текст предложения (скидки) от поставщика |
+------------+-----------------------+--------------+------------------------------------------+
| RoomPrices | Список элементов Room | Да           | Разбивка цен                             |
+------------+-----------------------+--------------+------------------------------------------+

Элемент Order/Items/HotelItem/PriceDetails/Room
-----------------------------------------------

Разбивка цен по дням заезда.

Атрибуты:

+------------+-----------------+--------------+------------------------------------------------------------------------+
| Имя        | Тип             | Обязательный | Описание                                                               |
+============+=================+==============+========================================================================+
| roomNumber | Число           | Да           | Количество таких номеров (>=1)                                         |
+------------+-----------------+--------------+------------------------------------------------------------------------+
| roomName   | Строка          | Да           | Название номера (размер, тип, вид)                                     |
+------------+-----------------+--------------+------------------------------------------------------------------------+
| child      | 0 или 1         | Да           | Есть ли в номере место для ребенка                                     |
+------------+-----------------+--------------+------------------------------------------------------------------------+
| cots       | Число от 1 до 2 | Нет          | Количество люлек (1 или 2, если нет – то аттрибут будет отсутствовать) |
+------------+-----------------+--------------+------------------------------------------------------------------------+

Дочерние элементы:

+-------+--------------+--------------+
| Имя   | Обязательный | Описание     |
+=======+==============+==============+
| Price | Да           | Цены по дням |
+-------+--------------+--------------+

Элемент Order/Items/HotelItem/PriceDetails/Room/Price
-----------------------------------------------------

Цена

Атрибуты:

+------------+-----------------------------+--------------+--------------------------+
| Имя        | Тип                         | Обязательный | Описание                 |
+============+=============================+==============+==========================+
| date       | Дата в формате "YYYY-MM-DD" | Да           | Дата действия цены       |
+------------+-----------------------------+--------------+--------------------------+
| available  | true или false              | Да           | Доступна ли разбивка цен |
+------------+-----------------------------+--------------+--------------------------+
| price      | Число                       | Да           | Цена за взрослого        |
+------------+-----------------------------+--------------+--------------------------+
| priceChild | Число                       | Нет          | Цена за ребенка          |
+------------+-----------------------------+--------------+--------------------------+
| priceCot   | Число                       | Нет          | Цена за люльку           |
+------------+-----------------------------+--------------+--------------------------+

- *Дочерние элементы: нет.*

Элемент Order/ContactInfo
-------------------------

Контактная информация с тем, кто бронирует заказ.

- *Атрибуты: нет.*

Дочерние элементы:

+---------+--------------------------------+--------------+------------------------------------------+
| Имя     | Тип                            | Обязательный | Описание                                 |
+=========+================================+==============+==========================================+
| Name    | Строка (максимум 100 символов) | Да           | Ф.И.О. заказчика                         |
+---------+--------------------------------+--------------+------------------------------------------+
| Email   | Строка (максимум 100 символов) | Да           | Адрес электронной почты заказчика        |
+---------+--------------------------------+--------------+------------------------------------------+
| Phone   | Строка (максимум 15 символов)  | Да           | Телефон заказчика                        |
+---------+--------------------------------+--------------+------------------------------------------+
| Comment | Строка                         | Да           | Комментарий к заказу (может быть пустым) |
+---------+--------------------------------+--------------+------------------------------------------+