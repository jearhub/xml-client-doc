Информация об элементах заказа
##############################

Описание XML схемы с информацией об элементах заказа
====================================================

Запрос на получение XML-описания элементов заказа сейчас формируется через URL (методом GET).

XSD-схема ответа с информацией об элементе заказа: 

- :download:`www/xsd/order/OrderItemInfoResponse.xsd <../../themes/hotelbook/static/xsd/order/OrderItemInfoResponse.xsd>`

Запрос информации об элементе заказе
------------------------------------

В запросе может быть идентификатор заказа ``?order_id=id_заказа``, взятый из ответа на создание заказа или идентификатор элемента заказа 
``?item_id=id_элемента`` (в последнем случае будет возвращена информация только об указанном элементе). 

Запрос формируется по пути: ``/xml/order_item_info``

Ответ на запрос информации об элементе заказа, OrderItemInfoResponse
--------------------------------------------------------------------

::

    <?xml version="1.0" encoding="utf-8"?>
    <OrderItemInfoResponse>
      [<Errors>
        <Error code="..." description="..."> - ошибки
      </Errors>]
     
      <Items
            orderId="..." - идентификатор заказа
      orderUserId="..." orderUserName="..." - идентификатор и имя пользователя, сделавшего заказ
            orderManagerId="..." orderManagerName="..." - идентификатор и имя куратора
      >
        <Item type="hotel" id="..." [useNds="true|false"] /> - идентификатор отеля, забронированного в заказе (может быть несколько элементов)
        [<Item type="transfer" id="..." [useNds="true|false"] />] - идентификатор трансфера, забронированного в заказе (может быть несколько элементов)
        [<Item type="vehicle" id="..."/>] - идентификатор авто, забронированного в заказе (может быть несколько элементов)
        <Item type="visa" id="..."> - данные о визе (виз может быть несколько)
          <Status>...</Status> - статус визы
          <Country id="...">...</Country> - страна визы
          <VisaCity>spb|msk</VisaCity> - город визовой поддержки
          <DepartureDate>...</DepartureDate> - дата выезда
          <ArrivalDate>...</ArrivalDate> - дата въезда
          <ArrivalPlace>...</ArrivalPlace> - пункт пересечения границы
          <Transport type="avia|sea|railway|avto">
            <Date>...</Date> - Дата въезда/вылета
            <From>
              <City id=""/> - города маршрута/рейса туда (может быть несколько)
            </From>
            <To>
              <City id=""/> - города маршрута/рейса обратно (может быть несколько)
            </To>
            [<Number>...</Number>] - номер рейса/поезда
            [<FlightTime>...</FlightTime>] - время прилета
          </Transport>
          <Price currency="...">...</Price>
          <PassportChild>...</PassportChild> - количество детей в паспортах
          <Paxes>
            <Pax id="..." [pax_id="..."]>
              [<Title>Mr|Ms|Mrs|Chld</Title>]
              [<Name>...</Name>]
              [<SecondName>...</SecondName>]
              [<BirthDate>...</BirthDate>]
              [<IsChild [age="..."]>true|false</IsChild>]
              [<Citizenship id="...">...</Citizenship>]
              [<Passport> - данные о паспорте
                <Series>...</Series>
                <Number>...</Number>
                <Expiration>...</Expiration>
              </Passport>]
              [<Insurances>
                [<Insurance id="...">...</Insurance>] - заказанная страховка (может быть несколько)
              </Insurances>]
            </Pax>
          </Paxes>
          <Hotels>
            <Hotel
             itemId="..."
             id="..." - идентификатор отеля
             cityId="..." - город отеля
             countryId="..." - страна отеля
             from="..." - дата приезда
             to="..." - дата выезда
             [external_hotel = 'true'] - отель есть в заказе, но не в визе
                   >...</Hotel> - название отеля
          </Hotels>
        </Item>
        <Item type="invitation" id="..."> - данные о сформированных приглашениях (может быть несколько)
          <Status>...</Status> - статус приглашения
          <Country id="...">...</Country>
          <Provider id="...">...</Provider> - поставщик визовой поддержки
          <Price currency="...">...</Price>
          <Paxes>
              <Pax id="..." [pax_id="..."]>
                [<Title>Mr|Ms|Mrs|Chld</Title>]
                [<Name>...</Name>]
                [<SecondName>...</SecondName>]
                [<BirthDate>...</BirthDate>]
                [<IsChild [age="..."]>true|false</IsChild>]
                [<Citizenship id="...">...</Citizenship>]
                [<Passport> - данные о паспорте
                  <Series>...</Series>
                  <Number>...</Number>
                  <Expiration>...</Expiration>
                </Passport>]
                [<Insurances>
                  [<Insurance id="...">...</Insurance>] - заказанная страховка (может быть несколько)
                </Insurances>]
              </Pax>
          </Paxes>
          <Hotels>
            <Hotel
                 itemId="..."
                 id="..." - идентификатор отеля

                 cityId="..." - город отеля
                 countryId="..." - страна отеля
                 from="..." - дата приезда

                 to="..." - дата выезда
                 [external_hotel = 'true'] - отель есть в заказе, но не в приглашении
                 >...</Hotel> - название отеля
          </Hotels>
        </Item>
      </Items>
    </OrderItemInfoResponse>

Элемент OrderItemInfoResponse
-----------------------------

Информация об элементах заказа (в большей мере о визах и приглашениях)

Корневой элемент.

**Атрибуты:** нет.

**Дочерние элементы:**

+--------+-------------------------------------+--------------------------+
| Имя    | Обязательный                        | Описание                 |
+========+=====================================+==========================+
| Errors | Нет                                 | Список ошибок, если есть |
+--------+-------------------------------------+--------------------------+
| Items  | Нет (отсутствует, если были ошибки) | Список элементов заказа  |
+--------+-------------------------------------+--------------------------+

Элемент Errors
--------------

Смотри страницу :doc:`Ошибки <../errors>`

Элемент Items
-------------

Список элементов заказа.

**Атрибуты:**

+--------------------+----------+----------------+--------------------------------------+
| Имя                | Тип      | Обязательный   | Описание                             |
+====================+==========+================+======================================+
| orderId            | Число    | Да             | id заказа                            |
+--------------------+----------+----------------+--------------------------------------+
| orderUserId        | Число    | Да             | id пользователя, создавшего заказ    |
+--------------------+----------+----------------+--------------------------------------+
| orderUserName      | Строка   | Да             | Имя пользователя, создавшего заказ   |
+--------------------+----------+----------------+--------------------------------------+
| orderManagerId     | Число    | Нет            | id куратора                          |
+--------------------+----------+----------------+--------------------------------------+
| orderManagerName   | Строка   | Нет            | Имя куратора                         |
+--------------------+----------+----------------+--------------------------------------+

**Дочерние элементы:**

+--------+----------------+---------------------------------+
| Имя    | Обязательный   | Описание                        |
+========+================+=================================+
| Item   | Нет            | Информация об элементе заказа   |
+--------+----------------+---------------------------------+

Элемент Items/Item
------------------

Информация об элементе заказа

**Атрибуты:**

+----------+----------------------------------------------+----------------+------------------------------------------------------------------------+
| Имя      | Тип                                          | Обязательный   | Описание                                                               |
+==========+==============================================+================+========================================================================+
| type     | hotel, transfer, vehicle, visa, invitation   | Да             | тип элемента                                                           |
+----------+----------------------------------------------+----------------+------------------------------------------------------------------------+
| id       | Число                                        | Да             | id элемента                                                            |
+----------+----------------------------------------------+----------------+------------------------------------------------------------------------+
| useNds   | true или false                               | Нет            | НДС включен или нет. Если атрибут отсутствует, налогом не облагается   |
+----------+----------------------------------------------+----------------+------------------------------------------------------------------------+

**Дочерние элементы:**

+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| Имя           | Тип     | Обязательный                     | Описание                                                                                                         |
+===============+=========+==================================+==================================================================================================================+
| Status        | Строка  | Да, только для виз и приглашений | Статус элемента                                                                                                  |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| Country       | Строка  | Да, только для виз и приглашений | Страна. Атрибуты: ''id'' - идентификатор страны                                                                  |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| Provider      | Строка  | Да, только для приглашений       | Поставщик визовой поддержки. Атрибуты: ''id'' - идентификатор поставщика (обязательный, если поставщик - не UTS) |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| VisaCity      | msk,spb | Да, только для виз               | Город визовой поддержки                                                                                          |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| DepartureDate | Дата    | Да, только для виз               | Дата выезда                                                                                                      |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| ArrivalDate   | Дата    | Да, только для виз               | Дата въезда                                                                                                      |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| ArrivalPlace  | Строка  | Да, только для виз               | Пункт пересечения границы                                                                                        |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| Transport     |         | Да, только для виз               | Данные о транспорте                                                                                              |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| Price         | Строка  | Да, только для виз и приглашений | Цена элемента. Атрибуты: ''currency'' - наименование валюты                                                      |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| PassportChild | Число   | Да, только для виз               | Количество детей в паспортах                                                                                     |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| Paxes         |         | Да, только для виз и приглашений | Список клиентов. Дочерние элементы: ''Pax'' - информация о клиенте                                               |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+
| Hotels        |         | Да, только для виз и приглашений | Список отелей, на которые сформирована виза/приглашение. Дочерние элементы: ''Hotel'' - информация об отеле      |
+---------------+---------+----------------------------------+------------------------------------------------------------------------------------------------------------------+


Элемент Items/Item/Transport
----------------------------

Информация о транспорте.

**Атрибуты:**

+------+--------------------------+--------------+----------------+
| Имя  | Тип                      | Обязательный | Описание       |
+======+==========================+==============+================+
| type | avia, sea, railway, avto | Да           | Тип транспорта |
+------+--------------------------+--------------+----------------+

**Дочерние элементы:**

+------------+--------+--------------+----------------------+
| Имя        | Тип    | Обязательный | Описание             |
+============+========+==============+======================+
| Date       | Дата   | Да           | Дата въезда/вылета   |
+------------+--------+--------------+----------------------+
| From       |        | Да           | Маршрут/рейс туда    |
+------------+--------+--------------+----------------------+
| To         |        | Да           | Маршрут/рейс обратно |
+------------+--------+--------------+----------------------+
| Number     | Строка | Нет          | Номер рейса/поезда   |
+------------+--------+--------------+----------------------+
| FlightTime | Время  | Нет          | Время прилета        |
+------------+--------+--------------+----------------------+

Элементы Items/Item/Transport/From и Items/Item/Transport/To
------------------------------------------------------------

Маршрут/рейс.

**Атрибуты:** нет.

**Дочерние элементы:**

+------+-----+--------------+-------------------------------------------------------+
| Имя  | Тип | Обязательный | Описание                                              |
+======+=====+==============+=======================================================+
| City | Тип | Да           | Город в маршруте, рейсе. Атрибуты: ''id'' - id города |
+------+-----+--------------+-------------------------------------------------------+

Элемент Items/Item/Paxes/Pax
----------------------------

Информация о персоне.

**Атрибуты:**

+-------+-------+--------------+------------+
| Имя   | Тип   | Обязательный | Описание   |
+=======+=======+==============+============+
| id    | Число | Да           | id персоны |
+-------+-------+--------------+------------+
| paxId | Число | Нет          | id персоны |
+-------+-------+--------------+------------+

**Дочерние элементы:**

+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| Имя         | Тип               | Обязательный | Описание                                                                                                                                                |
+=============+===================+==============+=========================================================================================================================================================+
| Title       | Mr, Mrs, Ms, Chld | Нет          | Обращение к персоне                                                                                                                                     |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| Name        | Строка            | Нет          | Имя персоны                                                                                                                                             |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| SecondName  | Строка            | Нет          | Фамилия персоны                                                                                                                                         |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| BirthDate   | Дата              | Нет          | Дата рождения персоны                                                                                                                                   |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| IsChild     | true или false    | Нет          | Является ли данный клиент ребенком. Атрибуты: ''age'' - возраст персоны, если это ребенок                                                               |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| Citizenship | Строка            | Нет          | Гражданство персоны. Атрибуты: ''id'' - id страны                                                                                                       |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| Passport    |                   | Нет          | Данные о паспорте. Дочерние элементы (все обязательны): ''Series'' - серия паспорта ''Number'' - номер паспорта ''Expiration'' - срок действия паспорта |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| Insurances  | Строка            | Да           | Список страховок. Дочерние элементы: ''Insurance'' - тип страховки (id типа в качестве атрибута этого элемента)                                         |
+-------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+

Элемент Items/Item/Hotels/Hotel
-------------------------------

Название отеля, на который сформирована виза/приглашение

**Атрибуты:**

+-----------+-------+--------------+----------------------------+
| Имя       | Тип   | Обязательный | Описание                   |
+===========+=======+==============+============================+
| itemId    | Число | Да           | id элемента заказа (отеля) |
+-----------+-------+--------------+----------------------------+
| id        | Число | Да           | id отеля                   |
+-----------+-------+--------------+----------------------------+
| cityId    | Число | Да           | id города отеля            |
+-----------+-------+--------------+----------------------------+
| countryId | Число | Да           | id страны отеля            |
+-----------+-------+--------------+----------------------------+
| from      | Дата  | Да           | Дата приезда               |
+-----------+-------+--------------+----------------------------+
| to        | Дата  | Да           | Дата выезда                |
+-----------+-------+--------------+----------------------------+

**Дочерние элементы:** нет.