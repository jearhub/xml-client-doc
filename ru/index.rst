.. XML Client API documentation master file, created by
   sphinx-quickstart on Mon May  5 12:59:02 2014.
   You can adapt this file completely to your liking, but it should at least
   contain the root `toctree` directive.

XML-шлюз HotelBook.ru
#####################

Протокол
========

Используется протокол взаимодействия, основанный на XML для формулировки запросов и на HTTP
для передачи основных параметров. Причины: HTTP нужен чтобы не усложнять то, что может быть
простым – получение простой информации. XML нужен чтобы была возможность передавать сложные
структуры в качестве параметров входа/выхода. XML – запрос необходимо передавать методом POST
в параметре “request”.

| Живой шлюз расположен по адресу: http://www.hotelbook.ru/xml
| Тестовый шлюз расположен по адресу: http://test.hotelbook.vsespo.ru/xml
| XSD схемы используемые в некоторых XML запросах/ответах расположены в: http://www.hotelbook.ru/xsd

 

| По адресу http://test.hotelbook.vsespo.ru/xml-test.php можно производить поиск по данным, получаемым от тестовых серверов.
| По адресу http://www.hotelbook.ru/xml-test.html можно производить поиск по реальным данным.

Авторизация
===========

Авторизация передаётся в параметрах URL: login, time, checksum.

- login – логин пользователя
- time – количество секунд от 01.01.1970 (unix timestamp),  по стандарту UTC.
- checksum = MD5 от конкатенации хэша пароля и времени, ``=md5($password_hash.$time)``. Если требуется контрольная сумма от реального пароля, то соответственно ``md5(md5($password).$time)``

Сервер также проверяет, что время находится в пределах 1 минуты от времени сервера, поэтому
разница во времени может быть причиной неудачной авторизации. Текущее время сервера может быть
сверено по адресу ``/xml/time`` или ``/xml/unix_time``

Для доступа к ``/xml/time`` и ``/xml/unix_time`` авторизация не требуется.

Все запросы выполняются с правами пользователя, переданного в авторизации.

Языки
=====

В текущей версии ХотелБука доступны 2 версии словарей (статистические данные)\:

- на русском языке
- на английском языке

Для получения данных на английском языке нужно в параметрах URL передать четвертый параметр — ``language=en``.
Например, запрос списка стран на русском выглядит так: http://hotelbook.ru/xml/countries?login=&time=&checksum=,
для английской версии будет выглядеть так – http://hotelbook.ru/xml/countries?login=&time=&checksum=&language=en.
Словари можно использовать на любом языке (русский/английский); при бронировании, подтверждени и аннуляции заказа
должен использоваться только русский язык (параметр ``language=en`` не передается).

Запросы статических данных
==========================

Для запросов стран, отелей, городов, типов/видов/размеров комнат, питания, локаций, достаточно простого HTTP запроса.
Формат ответа на данный момент не описывается.

**Список словарей**

+-------------------------+-------------------------+-------------------------+
| **Адрес**               | **Описание**            | **Дополнительно**       |
+-------------------------+-------------------------+-------------------------+
| /xml/time               | Время сервера в формате | Не требуется            |
|                         | ``Y-m-d H:i:s`` в XML   | авторизация             |
+-------------------------+-------------------------+-------------------------+
| /xml/unix_time          | Unix-время сервера      | Не требуется            |
|                         | (число секунд) в        | авторизация             |
|                         | формате plain (обычный  |                         |
|                         | текст)                  |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/countries          | Список всех Стран с     |                         |
|                         | идентификаторами        |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/resorts            | Список Курортов с       | В URL можно передать    |
|                         | идентификаторами        | параметр                |
|                         | курортов и стран        | ?country_id=id_страны   |
|                         |                         | Тогда будут             |
|                         |                         | представлены курорты по |
|                         |                         | этой стране.            |
+-------------------------+-------------------------+-------------------------+
| /xml/cities             | Список Городов с        | В URL можно передать    |
|                         | идентификаторами        | параметры               |
|                         | города, страны и        | ?resort_id=id_курорта   |
|                         | курорта                 | или                     |
|                         |                         | ?country_id=id_страны   |
|                         |                         | для ограниченной по     |
|                         |                         | стране/курорту выборке  |
|                         |                         | городов                 |
+-------------------------+-------------------------+-------------------------+
| /xml/location           | Список всех Локаций с   |                         |
|                         | идентификаторами        |                         |
|                         | локаций и города. Если  |                         |
|                         | is_global=1, то         |                         |
|                         | Локация применима ко    |                         |
|                         | всем городам            |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/room_size          | Размеры номеров, с      |                         |
|                         | указанием               |                         |
|                         | идентификатора(id),     |                         |
|                         | числа людей(pax),       |                         |
|                         | возможности размещения  |                         |
|                         | ребёнка(children),      |                         |
|                         | числа размещения люлек  |                         |
|                         | (cots)                  |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/meal               | Типы питаний            |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/meal_breakfast     | Типы завтраков          |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/hotel_cat          | Категории отелей.       |                         |
|                         | (Звёздность). С         |                         |
|                         | идентификаторами        |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/hotel_type         | Типы отелей             |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/hotel_facility     | Услуги отеля            |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/room_amenity       | Удобства номеров        |                         |
+-------------------------+-------------------------+-------------------------+
| /xml/hotel_list         | Список отелей. С        | В URL можно передать    |
|                         | идентификаторами,       | параметры               |
|                         | городом, категорией     | ?city_id=id_города –    |
|                         | звёздности, датой       | ограничить список       |
|                         | обновления(дата в       | отелей только по        |
|                         | формате unix_time,      | указанному городу.      |
|                         | число)                  |                         |
|                         |                         | ?update=дата – отели    |
|                         |                         | только обновленные      |
|                         |                         | после этой даты, дата в |
|                         |                         | формате ``Y-m-d H:i:s`` |
+-------------------------+-------------------------+-------------------------+
| /xml/hotel_detail       | Подробное описание      | В URL нужно             |
|                         | отеля                   | **обязательно** указать |
|                         |                         | hotel_name или          |
|                         |                         | hotel_id.               |
|                         |                         |                         |
|                         |                         | ?hotel_id – id отеля    |
|                         |                         |                         |
|                         |                         | ?hotel_name – название  |
|                         |                         | отеля                   |
|                         |                         |                         |
|                         |                         | Название и id отеля     |
|                         |                         | можно получить из       |
|                         |                         | списка /xml/hotel_list  |
+-------------------------+-------------------------+-------------------------+


Для каждого элемента, будь-то отель, комната, услуга отеля, удобство номера, города, курорт или прочее в системе
HotelBook существует свой уникальный идентификатор (id), в ответе на запрос любого из справочников из таблицы выше
присутствует этот идентификатор. Он используется в дальнейшей работе (поиск, бронирование, дополнительная информация,
и т.п.).

Запрос на поиск отелей
----------------------

| Обращение происходит по ``/xml/hotel_search``
| Подробнее см. :doc:`Поиск Отелей <hotels/hotel-search>`


Асинхронная выгрузка отелей
---------------------------

| Исходный поиск происходит по ``/xml/hotel_search?async=1``. (параметр async=1)
| Запрос ``/xml/hotel_search_async?login=&search_id=`` возвращает найденные на текущий момент отели
| Подробнее см. :doc:`Поиск Отелей <hotels/hotel-search>`

Запрос дополнительных данных поиска
-----------------------------------

| Обращение происходит по ``/xml/hotel_search_details``
| Подробнее см. :doc:`Дополнительная информация отеля <hotels/hotel-search-details>`

Создание заказа  (или добавление нового отеля в заказ)
------------------------------------------------------

| Обращение происходит по ``/xml/add_order``
| Подробнее см. :doc:`Создание заказа (или добавление нового отеля) <hotels/add-order>`

Для реального бронирования необходимо подтвердить заказ

Изменение заказа (существующих элементов)
-----------------------------------------

| Обращение происходит по ``/xml/modify_order``
| Подробнее см. :doc:`Изменения заказа <hotels/modify-order>`
| Для отправки изменений в работу необходимо подтвердить заказ

Подтверждение заказа
--------------------

| Обращение происходит по ``/xml/confirm_order``
| Подробнее см. :doc:`Подтверждение заказа <hotels/confirm-order>`

Информация о созданном заказе
-----------------------------

| Обращение происходит по ``/xml/order_info``
| Подробнее см. :doc:`Информация о созданном заказе <hotels/order-info>`

Информация об элементах созданного заказа
-----------------------------------------

| Обращение происходит по ``/xml/order_item_info``
| Подробнее см. :doc:`Информация об элементах заказа <hotels/order-item-info>`

Аннуляция заказа
----------------

| Обращение происходит по /xml/cancellation_order
| Подробнее см. :doc:`Аннуляция заказа <hotels/cancellation-order>`

Список заказов
--------------

| Обращение происходит по /xml/order_list
| Подробнее см. :doc:`Список заказов <hotels/order-list>`

Информация для ваучера
----------------------

| Обращение происходит по /xml/voucher_info
| Подробнее см. :doc:`Информация для ваучера <hotels/voucher-info>`

Выставление счета 1С
--------------------

| Обращение происходит по /xml/request_1c
| Подробнее см. :doc:`Выставление счета 1С <request1c>`

Получение рейтингов и отзывов TripAdvisor
-----------------------------------------

| Обращение происходит по /xml/tripadvisor_get_ratings и /xml/tripadvisor_get_rating_and_reviews_by_hotel
| Подробнее см. :doc:`Рейтинг TripAdvisor <hotels/trip-advisor-rating-list>`
| Подробнее см. :doc:`Рейтинг и отзывы TripAdvisor <hotels/trip-advisor-hotel-reviews>`