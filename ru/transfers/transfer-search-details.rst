Дополнительная Информация Трансфера
###################################

Описание XML схем получения дополнительной информации по трансферам
===================================================================

XSD-схемы:

-  ``www/xsd/TransferSearchDetailsRequest.xsd``
-  ``www/xsd/TransferSearchDetailsResponse.xsd``

Запрос на получение дополнительной информации, TransferSearchDetailsRequest
---------------------------------------------------------------------------

Запрос на получение дополнительной информации может проводиться только
когда известны id поиска (``searchId``) и id результа (``resultId``) из
проведённого поиска.

В одном запросе можно указывать информацию по нескольким результатам
поиска.

XML-схема запроса:

::

    <?xml version="1.0" encoding="utf-8"?>

    <TransferSearchDetailsRequest>
      <TransferSearches>
        <TransferSearch>
          <SearchId>..</SearchId> - id поиска
          <ResultId>..</ResultId> - id результата в поиске
        </TransferSearch>
      </TransferSearches>
    </TransferSearchDetailsRequest>

Элемент TransferSearchDetailsRequest
------------------------------------

Запрос на получение дополнительной информации по найденным трансферам.
Сейчас в качестве дополнительной информации возвращаются штрафы трансфера.

- Корневой элемент.
- Аттрибутов нет.

Дочерние элементы ``TransferSearchDetailsRequest``:

+----------------------+--------------------+--------------------------------------------+---------------------------------------+--------------------------------------------------------------------+
| **Элемент**          | **Обязательный**   | **Описание**                               |                                       |                                                                    |
+======================+====================+============================================+=======================================+====================================================================+
| ``TransferSearches`` | да                 | Трансферы из результатов поиска,           |                                       |                                                                    |
|                      |                    | для которых нужно получить доп. информацию |                                       |                                                                    |
+----------------------+--------------------+--------------------------------------------+---------------------------------------+--------------------------------------------------------------------+
|                      | **Элемент**        | **Обязательный**                           | **Описание**                          |                                                                    |
+----------------------+--------------------+--------------------------------------------+---------------------------------------+--------------------------------------------------------------------+
|                      | ``TransferSearch`` | да                                         | Трансфер из результатов поиска        |                                                                    |
|                      |                    |                                            | (можно указать много таких элементов) |                                                                    |
+----------------------+--------------------+--------------------------------------------+---------------------------------------+--------------------------------------------------------------------+
|                      |                    | **Элемент**                                | **Обязательный**                      | **Описание**                                                       |
+----------------------+--------------------+--------------------------------------------+---------------------------------------+--------------------------------------------------------------------+
|                      |                    | ``SearchId``                               | да                                    | id поиска (``searchId`` из ответа на поиск трансферов)             |
+----------------------+--------------------+--------------------------------------------+---------------------------------------+--------------------------------------------------------------------+
|                      |                    | ``ResultId``                               | да                                    | id результа из поиска (``resultId`` из ответа на поиск трансферов) |
+----------------------+--------------------+--------------------------------------------+---------------------------------------+--------------------------------------------------------------------+

Элемент TransferSearches
------------------------

В элементе указывается список трансферов из результатов поиска(см. `TransferSearchResponse <#h1164-8>`_), для которых запрашивается доп. информация.

- Обязательный элемент.
- Аттрибутов нет.

Дочерние элементы TransferSearches:

+--------------------+------------------+---------------------------------------+
| **Элемент**        | **Обязательный** | **Описание**                          |
+====================+==================+=======================================+
| ``TransferSearch`` | да               | трансфер из результатов поиска        |
|                    |                  | (можно указать много таких элементов) |
+--------------------+------------------+---------------------------------------+

Элемент TransferSearch
^^^^^^^^^^^^^^^^^^^^^^

В ответе на поиск трансферов мы получаем идентификаторы (аттрибуты):

- ``TransferSearch->searchId`` – id поиска и
- ``Transfers->Transfer->resultId`` – id результата поиска (для каждого трансфера свой).

- Эти id мы и задаём в этом элементе.
- Обязательный элемент.

Дочерние элементы ``TransferSearch``:

+--------------+------------------+-------------------------+
| **Элемент**  | **Обязательный** | **Описание**            |
+==============+==================+=========================+
| ``SearchId`` | да               | id проведённого поиска  |
+--------------+------------------+-------------------------+
| ``ResultId`` | да               | id результата из поиска |
+--------------+------------------+-------------------------+

Ответ на получение дополнительной информации, TransferSearchDetailsResponse
---------------------------------------------------------------------------

XML-схема ответа:

::

    <?xml version="1.0" encoding="utf-8"?>
    <TransferSearchDetailsResponse>
      <TransferSearchDetailsRequest>... исходный запрос ...</TransferSearchDetailsRequest>

      [<Errors>
        <Error code="..." description="..."> - ошибки
      </Errors>]
      <TransferSearchDetails>

          <Transfer
              resultId="id"
              transferName="..." 
              [providerId="id"] -- поля может не быть, в зависимости от настроек пользователя
              confirmation="onRequest|online|inaccessible"  -- вид подтверждения
              price="orig_price"  -- цена в валюте currency
              currency=".."
              comparePrice=" -- цена в рублях
              [useNds="true|false"]
              passengers=".." -- максимально пассажиров
              [transferTime="true|false"] -- время трансфера
              [checkInTime="true|false"] -- время регистрации
             >
          <Language id=".." > </Language>
          <Vehicle id=".." >
            <Name >...</Name>
            <Description >...</Description>
          </Vehicle>
          <PickUp
            cityId="id"
            locationType="id"
           [locationId="id"]/>
          <DropOff
            cityId="id"
            locationType="id"
           [locationId="id"]/>
            
          <ChargeConditions> - штрафы
            <Currency>..</Currency> - валюта штрафов
            <Cancellations> - штрафы при отмене
            <Cancellation - может быть несколько таких элементов
              charge="true|false" - есть ли штраф

              [from="2008-02-28T11:50:00"] - штраф действует от этой даты
              [to="2008-02-28T11:50:00"] - и до этой

              [price="100.00"] - цена в валюте Currency (элемент присутствует только если charge=true)
              [policy="1 ночь"] - политика штрафа
            />

            </Cancellations>
            <Amendments> - штрафы при изменении
            <Amendment - может быть несколько таких элементов
              charge="true|false"
              [from="YYYY-MM-DDThh:ii:ss"]
              [to="YYYY-MM-DDThh:ii:ss"]
              [price=".."]
              [policy=".."]
            />

            </Amendments>
          </ChargeConditions>
        </Transfer>
      </TransferSearchDetails>

    </TransferSearchDetailsResponse>

Элемент TransferSearchDetailsResponse
-------------------------------------

Ответ, сформированный сервером на получение доп. информации **TransferSearchDetailsRequest**.

- Корневой элемент.
- Аттрибутов нет.

Дочерние элементы ``TransferSearchDetailsResponse``:

+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
| **Элемент**                      | **Обязательный** | **Описание**                                             |                                                             |                           |
+==================================+==================+==========================================================+=============================================================+===========================+
| ``TransferSearchDetailsRequest`` | нет              | Исходный запрос, см. выше – TransferSearchDetailsRequest |                                                             |                           |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
| ``Errors``                       | нет              | Список ошибок, если есть                                 |                                                             |                           |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  | **Элемент**      | **Обязательный**                                         | **Описание**                                                |                           |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  | ``Error``        | да                                                       | Описание ошибки (и код), ошибок может быть много            |                           |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
| ``TransferSearchDetails``        | нет              | Полученная информация по запрошенным трансферам (список) |                                                             |                           |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  | **Элемент**      | **Обязательный**                                         | **Описание**                                                |                           |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  | ``Transfer``     | да                                                       | Доп. информация для трансфера (может быть много трансферов) |                           |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  |                  | **Элемент**                                              | **Обязательный**                                            | **Описание**              |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  |                  | ``Language``                                             | да                                                          | Язык ``Language``         |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  |                  | ``Vehicle``                                              | да                                                          | Транспорт ``Vehicle``     |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  |                  | ``PickUp``                                               | да                                                          | Посадка ``PickUp``        |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  |                  | ``DropOff``                                              | да                                                          | Высадка ``DropOff``       |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  |                  | ``Information``                                          | да                                                          | Дополнительная информация |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+
|                                  |                  | ``ChargeConditons``                                      | нет                                                         | Штрафы трансфера          |
+----------------------------------+------------------+----------------------------------------------------------+-------------------------------------------------------------+---------------------------+

Элемент TransferSearchDetailsRequest
------------------------------------

Исходный XML-запрос, который передал пользователь.
| Необязательный элемент. (Отстутствует если в синтаксисе исходного XML были ошибки)
| Описание схемы элемента см. выше (``TransferSearchDetailsRequest``)

Элемент Errors
--------------

Список ошибок (дочерние элементы ``Error``).
 Необязательный элемент.
 Аттрибутов нет.
 Дочерние элементы ``Errors``:

+-------------+------------------+---------------------------------------------------------------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                                                                            |
+=============+==================+=========================================================================================================+
| ``Error``   | да               | Код ошибки(``code``) и описание ошибки(``description``) как аттрибуты элемента. Ошибок может быть много |
+-------------+------------------+---------------------------------------------------------------------------------------------------------+

Элемент Error
^^^^^^^^^^^^^

Код и расшифровка ошибки.

- Обязательный элемент.
- Дочерних элементов нет.

Аттрибуты элемента ``Error``:

+-----------------+---------+------------------+-----------------+
| **Аттрибут**    | **Тип** | **Обязательный** | **Описание**    |
+=================+=========+==================+=================+
| ``code``        | строка  | да               | Код ошибки UTS. |
+-----------------+---------+------------------+-----------------+
| ``description`` | строка  | да               | Описание ошибки |
+-----------------+---------+------------------+-----------------+

Элемент TransferSearchDetails
-----------------------------

Список трансферов (дочерние элементы ``Transfer``).

- Необязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``TransferSearchDetail``:

+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
| **Элемент**  | **Обязательный**    | **Описание**                            |                           |                                                        |
+==============+=====================+=========================================+===========================+========================================================+
| ``Transfer`` | да                  | Дополнительная информация по трансферу. |                           |                                                        |
|              |                     | Трансферов может быть много             |                           |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              | **Элемент**         | **Обязательный**                        | **Описание**              |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              | ``Language``        | да                                      | Язык ``Language``         |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              | ``Vehicle``         | да                                      | Транспорт ``Vehicle``     |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              | ``PickUp``          | да                                      | Посадка ``PickUp``        |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              | ``DropOff``         | да                                      | Высадка ``DropOff``       |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              | ``Information``     | да                                      | Дополнительная информация |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              | ``ChargeConditons`` | нет                                     | Штрафы трансфера          |                                                        |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              |                     | **Элемент**                             | **Обязательный**          | **Описание**                                           |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              |                     | ``Currency``                            | да                        | Валюта штрафов                                         |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              |                     | ``Cancellations``                       | да                        | Штрафы при отмене (дочерние элементы ``Cancellation``) |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+
|              |                     | ``Amendments``                          | нет                       | Штрафы при изменении (дочерние элементы ``Amendment``) |
+--------------+---------------------+-----------------------------------------+---------------------------+--------------------------------------------------------+

Элемент Transfer
^^^^^^^^^^^^^^^^

| Содержит список параметров(аттрибутов) конкретного трансфера, его язык, транспорт, место посадки и высадки.
| Необязательный элемент. Может отсутствовать, если возникли ошибки или нет подходящих под критерии поиска трансферов.

Аттрибуты элемента ``Transfer``:

+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип**                         | **Обязательный** | **Описание**                                                                                            |
+==================+=================================+==================+=========================================================================================================+
| ``resultId``     | число                           | да               | id результата. Свой для каждого найденного трансфера.                                                   |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``transferName`` | строка                          | нет              | Название (краткое описание) трансфера                                                                   |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``providerId``   | число                           | нет              | id поставщика, который предоставил информацию об этом трансфере. Эта информация предоставляется не всем |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``confirmation`` | onRequest, online, inaccessible | да               | Вид подтверждения («по запросу», «онлайн» и «недоступен» соответственно).                               |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``price``        | цена                            | да               | Цена в валюте ``currency``                                                                              |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``currency``     | строка                          | да               | Название валюты трансфера                                                                               |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``comparePrice`` | цена                            | да               | Цена в рублях                                                                                           |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``useNds``       | true, false                     | нет              | Включен ли НДС (true – да, false – нет). Если аттрибут отсутствует - не облагается налогом              |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``passengers``   | число                           | да               | Максимальное число пассажиров                                                                           |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``transferTime`` | строка                          | нет              | Время трансфера                                                                                         |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``checkInTime``  | строка                          | нет              | Время регистрации                                                                                       |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+

 Дочерние элементы ``Transfer``:  ``Language``, ``Vehicle``, ``PickUp``, ``DropOff``, ``Information``

Элемент Language
''''''''''''''''

Язык трансфера.

- Обязательный элемент.
- Аттрибуты: id языка (из словаря /xml/languages)
- Дочерних элементов нет.

Элемент Vehicle
'''''''''''''''

Транспорт трансфера.

- Обязательный элемент.
- Аттрибуты: id транспорта (из словаря /xml/transfer\_vehicles)

Дочерние элементы:

+-----------------+------------------+---------------------+
| **Элемент**     | **Обязательный** | **Описание**        |
+=================+==================+=====================+
| ``Name``        | да               | Название транспорта |
+-----------------+------------------+---------------------+
| ``Description`` | да               | Описание транспорта |
+-----------------+------------------+---------------------+

Элемент PickUp
--------------

В элементе указываются параметры посадки (как аттрибуты).

- Обязательный элемент.

Аттрибуты:

+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип** | **Обязательный** | **Описание**                                                                                       |
+==================+=========+==================+====================================================================================================+
| ``cityId``       | число   | да               | id города, список всех доступных городов /xml/cities                                               |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationType`` | число   | да               | id локации трансфера, список всех доступных локаций /xml/transfer\_locations                       |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationId``   | число   | нет              | id аэропорта или станции, список всех доступных аэропортов /xml/airports , станций - /xml/stations |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+

Дочерних элементов нет.

Элемент DropOff
~~~~~~~~~~~~~~~

В элементе указываются параметры высадки (как аттрибуты).

- Обязательный элемент.

Аттрибуты:

+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип** | **Обязательный** | **Описание**                                                                                       |
+==================+=========+==================+====================================================================================================+
| ``cityId``       | число   | да               | id города, список всех доступных городов /xml/cities                                               |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationType`` | число   | да               | id локации трансфера, список всех доступных локаций /xml/transfer\_locations                       |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationId``   | число   | нет              | id аэропорта или станции, список всех доступных аэропортов /xml/airports , станций - /xml/stations |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+

Дочерних элементов нет.

Элемент ChargeConditions
''''''''''''''''''''''''

Штрафы при отмене и изменении.

- Необязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``ChargeConditions``:

+-------------------+------------------+----------------------+-------------------------------------------------------------+
| **Элемент**       | **Обязательный** | **Описание**         |                                                             |
+===================+==================+======================+=============================================================+
| ``Currency``      | да               | Валюта штрафов       |                                                             |
+-------------------+------------------+----------------------+-------------------------------------------------------------+
| ``Cancellations`` | да               | Штрафы при отмене    |                                                             |
+-------------------+------------------+----------------------+-------------------------------------------------------------+
|                   | **Элемент**      | **Обязательный**     | **Описание**                                                |
+-------------------+------------------+----------------------+-------------------------------------------------------------+
|                   | ``Cancellation`` | да                   | Штрафы при омене (может быть несколько таких элементов)     |
+-------------------+------------------+----------------------+-------------------------------------------------------------+
| ``Amendments``    | нет              | Штрафы при изменении |                                                             |
+-------------------+------------------+----------------------+-------------------------------------------------------------+
|                   | **Элемент**      | **Обязательный**     | **Описание**                                                |
+-------------------+------------------+----------------------+-------------------------------------------------------------+
|                   | ``Amendment``    | да                   | Штрафы при изменении (может быть несколько таких элементов) |
+-------------------+------------------+----------------------+-------------------------------------------------------------+

Элемент Cancellation
''''''''''''''''''''

Штрафы при отмене.

- Оязательный элемент.
- Дочерних элементов нет.

Аттрибуты элемента ``Cancellation``:

+--------------+---------+------------------+------------------------------------------------------------------------------------+
| **Аттрибут** | **Тип** | **Обязательный** | **Описание**                                                                       |
+==============+=========+==================+====================================================================================+
| ``charge``   | логич.  | да               | есть штраф(true), или нет(false)                                                   |
+--------------+---------+------------------+------------------------------------------------------------------------------------+
| ``from``     | дата    | нет              | дата/время начала действия штрафа                                                  |
+--------------+---------+------------------+------------------------------------------------------------------------------------+
| ``to``       | дата    | нет              | дата/время окончания действия штрафа                                               |
+--------------+---------+------------------+------------------------------------------------------------------------------------+
| ``price``    | число   | нет              | цена в валюте Currency (аттрибут будет присутствовать только если ``charge``=true) |
+--------------+---------+------------------+------------------------------------------------------------------------------------+
| ``policy``   | строка  | нет              | политика штрафа (иногда вместо цены может указывать политика, например «1 ночь»    |
+--------------+---------+------------------+------------------------------------------------------------------------------------+

Элемент Amendment
'''''''''''''''''

Штрафы при отмене.

- Оязательный элемент.
- Дочерних элементов нет.
- Аттрибуты элемента как у элемента ``Cancellation``.