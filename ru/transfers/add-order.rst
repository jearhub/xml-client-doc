Создание заказа или добавление нового элемента
##############################################

Описание XML схемы
==================

XSD-схемы для создания заказа или добавления нового трансфера:

:download:`www/xsd/order/AddOrderRequest.xsd <../../themes/hotelbook/static/xsd/order/AddOrderRequest.xsd>`

:download:`www/xsd/order/AddOrderResponse.xsd <../../themes/hotelbook/static/xsd/order/AddOrderResponse.xsd>`

После того, как был произведён поиск трансферов, можно создать заказ, с
одним или несколькими трансферами. При создании заказа указываются
контактная информация: ф.и.о., email адрес, телефон и если нужно
комментарий к заказу. Также указывается информация о лидере трансфера и
данные мест прибытия и отбытия.

С помощью этого заказа также можно добавлять новые трансферы в уже
существующий заказ. Для этого нужно указать id заказа

Запрос, AddOrderRequest
-----------------------

XML-схема запроса:

::

    <?xml version="1.0" encoding="utf-8"?>
    <AddOrderRequest>
      [<ContactInfo> - контактная информация (если заказ еще не создан)
        <Name>..</Name> - имя
        <Email>..</Email> - email
        <Phone>..</Phone> - телефон
        <Comment>..</Comment> - комментарий
      </ContactInfo>]
      [<Tag></Tag>] - референс заказа (нужен только для нового заказа)
      [<OrderId></OrderId>] - id заказа (если трансфер (трансферы) нужно добавить в существующий заказ)
      [<AccountComment></AccountComment>] - Комментарий для счета (Если для XML-клиента включено право "Видит комментарий для счета", то это поле для него обязательное.)
      [<Partner>  - Контрагент
        [<PartnerId>...</PartnerId>] - номер контрагента
        [<PartnerBase>...</PartnerBase>] - номер базы контрагента
        [<PartnerName>...</PartnerName>] - имя клиента
      </Partner>] 
      <Items> - элементы заказа
        <TransferItem> - трансфер
          <Search
            resultId=".." - id результата в поиске
            searchId=".." - id поиска
          />
          [<PayForm>cash|cashless<PayForm>] - форма оплаты заказа (должна быть одинаковой для всех трансферов заказа), для существующего заказа указывать необязательно
          <LeadingPax>
             <Title>Mr|Mrs|Ms|Chld</Title> - обращение
             <FirstName>..</FirstName> - имя (латинские)
             <LastName>..</LastName> - фамилия (латинские)
             [<Phone>..</Phone>] - телефон (для поставщика UTS Hotels)
          </LeadingPax>
          <PickUp>
        <AirportId>..</AirportId>
        <FlightNum>..</FlightNum>
        <ArrivalAirportId>..</ArrivalAirportId>
        <Time>..</Time>
        или
        <StationId>..</StationId>
        <TrainNum>..</TrainNum>
        <ArrivalCityId>..</ArrivalCityId>
        <Time>..</Time>
        или
        <HotelId>..</HotelId>
        <Time>..</Time>
        или
        <Address>
           <AddressLine>..</AddressLine>
           [<AddressLine>..</AddressLine>]
        </Address>
        <ZipCode>..</ZipCode>
        <District>..</District>
        <Phone>..</Phone>
        <Time>..</Time>
        или
        <ShipName>..</ShipName>
        <ShipCompanyName>..</ShipCompanyName>
        <ArrivalCity>..</ArrivalCity>
        <Time>..</Time>
          </PickUp>
          <DropOff>
          <AirportId>..</AirportId>
          <FlightNum>..</FlightNum>
          <DepartureAirportId>..</ArrivalAirportId>
          <Time>..</Time>
          или
          <StationId>..</StationId>
          <TrainNum>..</TrainNum>
          <DepartureCityId>..</ArrivalCityId>
          <Time>..</Time>
          или
          <HotelId>..</HotelId>
          или
          <Address>
             <AddressLine>..</AddressLine>
             [<AddressLine>..</AddressLine>]
          </Address>
          <ZipCode>..</ZipCode>
          <District>..</District>
          <Phone>..</Phone>
          или
          <ShipName>..</ShipName>
          <ShipCompanyName>..</ShipCompanyName>
          <DepartureCity>..</ArrivalCity>
          <Time>..</Time>
          </DropOff>
        </TransferItem>
      </Items>
    </AddOrderRequest>

Элемент AddOrderRequest
-----------------------

Запрос на создание заказа.

- Корневой элемент.
- Аттрибутов нет.

Дочерние элементы ``AddOrderRequest``:

+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
| **Элемент**        | **Обязательный**                        | **Описание**          |                                            |                                                                |
+====================+=========================================+=======================+============================================+================================================================+
| ``ContactInfo``    | да для нового заказа                    | Контактная информация |                                            |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**      | **Описание**                               |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``Name``                                | да                    | ф.и.о.                                     |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``Email``                               | да                    | email адрес                                |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``Phone``                               | да                    | телефон (15 символов)                      |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``Comment``                             | да                    | комментарий к заказу (может быть пустым)   |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
| ``Tag``            | да для нового заказа                    | Референс заказа       |                                            |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
| ``AccountComment`` | да, если для XML-клиента включено право | Комментарий для счета |                                            |                                                                |
|                    | "Видит комментарий для счета"           |                       |                                            |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
| ``Partner``        | нет                                     | Контрагент из ЮТС24   |                                            |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**      | **Описание**                               |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``PartnerId``                           | нет                   | Номер контрагента                          |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``PartnerBase``                         | нет                   | Номер базы                                 |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``PartnerName``                         | нет                   | Имя клиента                                |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
| ``OrderId``        | да, если добавляем трансфер             | id заказа             |                                            |                                                                |
|                    | в существующий заказ                    |                       |                                            |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
| ``Items``          | да                                      | Элементы заказа       |                                            |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | **Элемент**                             | **Обязательный**      | **Описание**                               |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    | ``TransferItem``                        | да                    | Элемент заказа (может быть много в заказе) |                                                                |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    |                                         | **Элемент**           | **Обязательный**                           | **Описание**                                                   |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    |                                         | ``Search``            | да                                         | Идентификаторы из результата поиска трансферов (как аттрибуты) |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    |                                         | ``PayForm``           | да для нового заказа                       | Форма оплаты                                                   |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    |                                         | ``LeadingPax``        | да                                         | Лидер трансфера (обращение, имя, фамилия)                      |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    |                                         | ``PickUp``            | да                                         | Параметры места прибытия                                       |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+
|                    |                                         | ``DropOff``           | да                                         | Параметры места отбытия                                        |
+--------------------+-----------------------------------------+-----------------------+--------------------------------------------+----------------------------------------------------------------+

Элемент ContactInfo
-------------------

Контактная информация с тем, кто бронирует заказ.

- Для нового заказа обязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``ContactInfo``:

+-------------+------------------+-------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                    |
+=============+==================+=================================================+
| ``Name``    | да               | ф.и.о заказчика (максимум 100 символов)         |
+-------------+------------------+-------------------------------------------------+
| ``Email``   | да               | email – адрес заказчика (максимум 100 символов) |
+-------------+------------------+-------------------------------------------------+
| ``Phone``   | да               | телефон заказчика (максимум 15 символов)        |
+-------------+------------------+-------------------------------------------------+
| ``Comment`` | да               | комментарий к заказу (может быть пустым)        |
+-------------+------------------+-------------------------------------------------+

Элемент Tag
-----------

Референс заказа.

- Для нового заказа обязательный элемент.
- Аттрибутов нет.
- Дочерних элементов нет.

Элемент OrderId
---------------

Идентификатор существующего заказа.

- Необходимо указывать в том случае, если Вы желаете добавить трансфер (трансферы) в уже созданный ранее заказ.
- Аттрибутов нет.
- Дочерних элементов нет.

Элемент AccountComment
----------------------

Комментарий для счета.

- Необходимо указывать в том случае, если для XML-клиента включено право "Видит комментарий для счета".
- Аттрибутов нет.
- Дочерних элементов нет.

Элемент Partner
---------------
Контрагент из ЮТС24
- *Необязательный элемент*
- *Аттрибутов нет.*

Дочерние элементы ``Partner``:

+-----------------+------------------+-------------------------------------------------+---------------------+
| **Элемент**     | **Обязательный** | **Описание**                                    | **Тип**             |
+=================+==================+=================================================+=====================+
| ``PartnerId``   | нет              | Номер контрагента.                              | Строка (8 символов) |
+-----------------+------------------+-------------------------------------------------+---------------------+
| ``PartnerBase`` | нет              | Номер базы контрагента.                         | Число               |
+-----------------+------------------+-------------------------------------------------+---------------------+
| ``PartnerName`` | нет              | Имя клиента                                     | Имя клиента         |
+-----------------+------------------+-------------------------------------------------+---------------------+

Элемент Items
-------------

Элементы заказа. Трансферов может быть указано много.

- Обязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``Items``:

+------------------+------------------+----------------------+----------------------------------------------------------------+
| **Элемент**      | **Обязательный** | **Описание**         |                                                                |
+==================+==================+======================+================================================================+
| ``TransferItem`` | да               | Элемент заказа       |                                                                |
+------------------+------------------+----------------------+----------------------------------------------------------------+
|                  | **Элемент**      | **Обязательный**     | **Описание**                                                   |
+------------------+------------------+----------------------+----------------------------------------------------------------+
|                  | ``Search``       | да                   | Идентификаторы из результата поиска трансферов (как аттрибуты) |
+------------------+------------------+----------------------+----------------------------------------------------------------+
|                  | ``LeadingPax``   | да                   | Лидер трансфера (обращение, имя, фамилия)                      |
+------------------+------------------+----------------------+----------------------------------------------------------------+
|                  | ``PayForm``      | да для нового заказа | Форма оплаты                                                   |
+------------------+------------------+----------------------+----------------------------------------------------------------+
|                  | ``PickUp``       | да                   | Параметры места прибытия                                       |
+------------------+------------------+----------------------+----------------------------------------------------------------+
|                  | ``DropOff``      | да                   | Параметры места отбытия                                        |
+------------------+------------------+----------------------+----------------------------------------------------------------+

Элемент TransferItem
^^^^^^^^^^^^^^^^^^^^

Элемент заказа – трансферов. Может быть много таких элементов.

- Обязательный элемент.
- Аттрибутов нет.

Дочерние элементы ``TransferItem``:

+----------------+------------------+----------------------------------------------------------------+
| **Элемент**    | **Обязательный** | **Описание**                                                   |
+================+==================+================================================================+
| ``Search``     | да               | Идентификаторы из результата поиска трансферов (как аттрибуты) |
+----------------+------------------+----------------------------------------------------------------+
| ``PayForm``    | нет              | Форма оплаты этого заказа                                      |
+----------------+------------------+----------------------------------------------------------------+
| ``LeadingPax`` | да               | Лидер трансфера (обращение, имя, фамилия)                      |
+----------------+------------------+----------------------------------------------------------------+
| ``PickUp``     | да               | Параметры места прибытия                                       |
+----------------+------------------+----------------------------------------------------------------+
| ``DropOff``    | да               | Параметры места отбытия                                        |
+----------------+------------------+----------------------------------------------------------------+

Элемент Search
''''''''''''''

Идентификаторы трансфера из ответа на поиск трансферов.

- Обязательный элемент.
- Дочерних элементов нет.

Аттрибуты элемента ``Search``:

+--------------+---------+------------------+-----------------------------------------+
| **Аттрибут** | **Тип** | **Обязательный** | **Описание**                            |
+==============+=========+==================+=========================================+
| ``resultId`` | число   | да               | id результата из поиска                 |
+--------------+---------+------------------+-----------------------------------------+
| ``searchId`` | число   | да               | id поиска, из которого указан результат |
+--------------+---------+------------------+-----------------------------------------+

Элемент PayForm
'''''''''''''''

Форма оплаты.

- Допустимые значения: cash (наличная форма оплаты), cashless (безналичная форма).
- Необязательный элемент. По умолчанию - наличная форма оплаты (cash)
- Дочерних элементов нет.
- Аттрибутов элемента нет.

Элемент LeadingPax
''''''''''''''''''

Лидер заказа.

- Обязательный элемент.
- Аттрибутов элемента нет.

Дочерние элементы:

+-----------------+---------------------+--------------------+-----------------------------------------------------+
| **Элемент**     | **Тип**             | **Обязательный**   | **Описание**                                        |
+-----------------+---------------------+--------------------+-----------------------------------------------------+
| ``Title``       | Mr, Ms, Mrs, Chld   | да                 | обращение                                           |
+-----------------+---------------------+--------------------+-----------------------------------------------------+
| ``FirstName``   | строка              | да                 | имя клиента (латинскими буквами)                    |
+-----------------+---------------------+--------------------+-----------------------------------------------------+
| ``LastName``    | строка              | да                 | фамилия клиента (латинскими буквами)                |
+-----------------+---------------------+--------------------+-----------------------------------------------------+
| ``Phone``       | строка              | нет                | телефон (обязательный, для поставщика UTS Hotels)   |
+-----------------+---------------------+--------------------+-----------------------------------------------------+

Элемент PickUp
''''''''''''''

Параметры места прибытия.

- Обязательный элемент.
- Аттрибутов элемента нет.

Дочерние элементы (если тип точки - аэропорт):

+------------------------+-----------+--------------------+-----------------------+
| **Элемент**            | **Тип**   | **Обязательный**   | **Описание**          |
+------------------------+-----------+--------------------+-----------------------+
| ``AirportId``          | число     | да                 | id аэропорта          |
+------------------------+-----------+--------------------+-----------------------+
| ``FlightNum``          | строка    | да                 | номер рейса           |
+------------------------+-----------+--------------------+-----------------------+
| ``ArrivalAirportId``   | число     | да                 | id аэропорта вылета   |
+------------------------+-----------+--------------------+-----------------------+
| ``Time``               | HH:SS     | да                 | время прилета         |
+------------------------+-----------+--------------------+-----------------------+

Дочерние элементы (если тип точки - станция):

+---------------------+-----------+--------------------+---------------------+
| **Элемент**         | **Тип**   | **Обязательный**   | **Описание**        |
+---------------------+-----------+--------------------+---------------------+
| ``StationId``       | число     | да                 | id станции          |
+---------------------+-----------+--------------------+---------------------+
| ``TrainNum``        | строка    | да                 | номер поезда        |
+---------------------+-----------+--------------------+---------------------+
| ``ArrivalCityId``   | число     | да                 | id города отбытия   |
+---------------------+-----------+--------------------+---------------------+
| ``Time``            | HH:SS     | да                 | время прибытия      |
+---------------------+-----------+--------------------+---------------------+

Дочерние элементы (если тип точки - отель):

+---------------+-----------+--------------------+-----------------------+
| **Элемент**   | **Тип**   | **Обязательный**   | **Описание**          |
+---------------+-----------+--------------------+-----------------------+
| ``HotelId``   | число     | да                 | id отеля              |
+---------------+-----------+--------------------+-----------------------+
| ``Time``      | HH:SS     | да                 | время подачи машины   |
+---------------+-----------+--------------------+-----------------------+

Дочерние элементы (если тип точки - адрес):

+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| **Элемент**  | **Тип**                 | **Обязательный** | **Описание**                                                                                      |
+==============+=========================+==================+===================================================================================================+
| ``Address``  | вложенные элементы      | да               | адрес в одной или двух строках (вложенные элементы ``AddressLine``), каждая длиной до 40 символов |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| ``ZipCode``  | строка (до 10 символов) | да               | почтовый индекс                                                                                   |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| ``District`` | строка (до 20 символов) | да               | название района                                                                                   |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| ``Phone``    | строка                  | да               | номер телефона                                                                                    |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| ``Time``     | HH:SS                   | да               | время подачи машины                                                                               |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+

Дочерние элементы (если тип точки - порт):

+---------------------+---------+------------------+-------------------------------+
| **Элемент**         | **Тип** | **Обязательный** | **Описание**                  |
+=====================+=========+==================+===============================+
| ``ShipName``        | строка  | да               | название корабля              |
+---------------------+---------+------------------+-------------------------------+
| ``ShipCompanyName`` | строка  | да               | название корабельной компании |
+---------------------+---------+------------------+-------------------------------+
| ``ArrivalCity``     | строка  | да               | название города отбытия       |
+---------------------+---------+------------------+-------------------------------+
| ``Time``            | HH:SS   | да               | время прибытия                |
+---------------------+---------+------------------+-------------------------------+

Элемент DropOff
'''''''''''''''

Параметры места отбытия.

- Обязательный элемент.
- Аттрибутов элемента нет.

Дочерние элементы (если тип точки - аэропорт):

+------------------------+---------+------------------+-------------------------+
| **Элемент**            | **Тип** | **Обязательный** | **Описание**            |
+========================+=========+==================+=========================+
| ``AirportId``          | число   | да               | id аэропорта            |
+------------------------+---------+------------------+-------------------------+
| ``FlightNum``          | строка  | да               | номер рейса             |
+------------------------+---------+------------------+-------------------------+
| ``DepartureAirportId`` | число   | да               | id аэропорта назначения |
+------------------------+---------+------------------+-------------------------+
| ``Time``               | HH:SS   | да               | время отлета            |
+------------------------+---------+------------------+-------------------------+

Дочерние элементы (если тип точки - станция):

+---------------------+---------+------------------+----------------------+
| **Элемент**         | **Тип** | **Обязательный** | **Описание**         |
+=====================+=========+==================+======================+
| ``StationId``       | число   | да               | id станции           |
+---------------------+---------+------------------+----------------------+
| ``TrainNum``        | строка  | да               | номер поезда         |
+---------------------+---------+------------------+----------------------+
| ``DepartureCityId`` | число   | да               | id города назначения |
+---------------------+---------+------------------+----------------------+
| ``Time``            | HH:SS   | да               | время отправки       |
+---------------------+---------+------------------+----------------------+

Дочерние элементы (если тип точки - отель):

+-------------+---------+------------------+--------------+
| **Элемент** | **Тип** | **Обязательный** | **Описание** |
+=============+=========+==================+==============+
| ``HotelId`` | число   | да               | id отеля     |
+-------------+---------+------------------+--------------+

Дочерние элементы (если тип точки - адрес):

+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| **Элемент**  | **Тип**                 | **Обязательный** | **Описание**                                                                                      |
+==============+=========================+==================+===================================================================================================+
| ``Address``  | вложенные элементы      | да               | адрес в одной или двух строках (вложенные элементы ``AddressLine``), каждая длиной до 40 символов |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| ``ZipCode``  | строка (до 10 символов) | да               | почтовый индекс                                                                                   |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| ``District`` | строка (до 20 символов) | да               | название района                                                                                   |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+
| ``Phone``    | строка                  | да               | номер телефона                                                                                    |
+--------------+-------------------------+------------------+---------------------------------------------------------------------------------------------------+

Дочерние элементы (если тип точки - порт):

+---------------------+---------+------------------+-------------------------------+
| **Элемент**         | **Тип** | **Обязательный** | **Описание**                  |
+=====================+=========+==================+===============================+
| ``ShipName``        | строка  | да               | название корабля              |
+---------------------+---------+------------------+-------------------------------+
| ``ShipCompanyName`` | строка  | да               | название корабельной компании |
+---------------------+---------+------------------+-------------------------------+
| ``DepartureCity``   | строка  | да               | название города назначения    |
+---------------------+---------+------------------+-------------------------------+
| ``Time``            | HH:SS   | да               | время отправки                |
+---------------------+---------+------------------+-------------------------------+

Ответ на создание заказа, AddOrderResponse
------------------------------------------

XML-схема ответа:

::

    <?xml version="1.0" encoding="utf-8"?>
      <AddOrderResponse>
        [<Errors>
          <Error code="..." description="..."> - ошибки
        </Errors>]
        [<OrderId>..</OrderId>] - id созданного заказа
      </AddOrderResponse>

Элемент AddOrderResponse
------------------------

Ответ, сформированный сервером на добавление заказа **AddOrderRequest**.

- Корневой элемент.
- Аттрибутов нет.

Дочерние элементы ``AddOrderResponse``:

+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
| **Элемент** | **Обязательный** | **Описание**                                                |                                                  |
+=============+==================+=============================================================+==================================================+
| ``Errors``  | нет              | Список ошибок, если есть                                    |                                                  |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
|             | **Элемент**      | **Обязательный**                                            | **Описание**                                     |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
|             | ``Error``        | да                                                          | Описание ошибки (и код), ошибок может быть много |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+
| ``OrderId`` | нет              | Id созданного заказа, если удалось создать (не было ошибок) |                                                  |
+-------------+------------------+-------------------------------------------------------------+--------------------------------------------------+

Элемент Errors
--------------

Смотри страницу :doc:`Ошибки <../errors>`

Элемент OrderId
---------------

Id нового заказа, если его удалось создать (в том случае, если не было ошибок).

- Необязательный элемент.
- Аттрибутов нет.
- Дочерних элементов нет.