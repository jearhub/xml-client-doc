Поиск Трансферов
################

Описание XML схем поиска трансферов
===================================

XSD-схемы поиска трансферов:

:download:`www/xsd/transfer/TransferSearchRequest.xsd <../../themes/hotelbook/static/xsd/transfer/TransferSearchRequest.xsd>`

:download:`www/xsd/transfer/TransferSearchResponse.xsd <../../themes/hotelbook/static/xsd/transfer/TransferSearchResponse.xsd>`

Асинхронный поиск трансферов - см. `Элемент SearchId <#h1285-20>`_

Запрос на поиск трансферов, TransferSearchRequest
-------------------------------------------------

XML-схема запроса:

::

    <?xml version="1.0" encoding="utf-8"?>

    <TransferSearchRequest>
      <Request
        date="YYYY-MM-DD"
        passengers=".."
       [language="id"]/>
       [vehicle="id"]/>
       [assistant="true|false"]/>
       [confirmation="online|onRequest|all"]/>
      <Providers>
         <ProviderId>..</ProviderId>
      </Providers>
      <PickUp
        cityId="id"
        locationType="id"
       [locationId="id"]/>
      <DropOff
        cityId="id"
        locationType="id"
       [locationId="id"]/>
    </TransferSearchRequest>

Элемент TransferSearchRequest
-----------------------------

Запрос на поиск трансферов.
 Корневой элемент.
 Аттрибутов нет.
 Дочерние элементы ``TransferSearchRequest``:

+---------------+------------------+-----------------------------------+------------------------------+
| **Элемент**   | **Обязательный** | **Описание**                      |                              |
+===============+==================+===================================+==============================+
| ``Request``   | да               | Параметры запроса (как аттрибуты) |                              |
+---------------+------------------+-----------------------------------+------------------------------+
|               | **Элемент**      | **Обязательный**                  | **Описание**                 |
+---------------+------------------+-----------------------------------+------------------------------+
| ``Providers`` | нет              | Поставщики                        |                              |
+---------------+------------------+-----------------------------------+------------------------------+
|               | **Элемент**      | **Обязательный**                  | **Описание**                 |
+---------------+------------------+-----------------------------------+------------------------------+
|               | ``ProviderId``   | да                                | Поставщик (может быть много) |
+---------------+------------------+-----------------------------------+------------------------------+
| ``PickUp``    | да               | Параметры посадки (как аттрибуты) |                              |
+---------------+------------------+-----------------------------------+------------------------------+
| ``DropOff``   | да               | Параметры высадки (как аттрибуты) |                              |
+---------------+------------------+-----------------------------------+------------------------------+

Элемент Request
---------------

В элементе указываются параметры запроса (как аттрибуты).

- Обязательный элемент.
- Дочерних элементов нет.

Аттрибуты элемента ``Request``:

+------------------+--------------------------------+------------------+--------------------------------------------------------------------------+
| **Аттрибут**     | **Тип**                        | **Обязательный** | **Описание**                                                             |
+==================+================================+==================+==========================================================================+
| ``date``         | дата, в формате ``YYYY-MM-DD`` | да               | Дата трансфера                                                           |
+------------------+--------------------------------+------------------+--------------------------------------------------------------------------+
| ``passengers``   | число                          | да               | Количество пассажиров                                                    |
+------------------+--------------------------------+------------------+--------------------------------------------------------------------------+
| ``language``     | число                          | нет              | id языка, список всех доступных языков /xml/languages                    |
+------------------+--------------------------------+------------------+--------------------------------------------------------------------------+
| ``vehicle``      | число                          | нет              | id транспорта, список всех доступных транспортов /xml/transfer\_vehicles |
+------------------+--------------------------------+------------------+--------------------------------------------------------------------------+
| ``assistant``    | true, false                    | нет              | Необходимость асистента                                                  |
+------------------+--------------------------------+------------------+--------------------------------------------------------------------------+
| ``confirmation`` | online, onRequest, all         | нет              | Требуемый вид подтверждения. Если all или не указан – независимо         |
+------------------+--------------------------------+------------------+--------------------------------------------------------------------------+

Элемент Providers
-----------------

Список поставщиков, по которым будет производиться поиск (указываются как вложенные элементы ``ProviderId``).

Этот элемент имеют право указывать только те пользователи, у которых установлено право "Видит поставщика".

- Необязательный элемент.
- Аттрибутов нет.

Дочерние элементы:

+----------------+------------------+----------------------------------------------------------------------------------------------------+
| **Элемент**    | **Обязательный** | **Описание**                                                                                       |
+================+==================+====================================================================================================+
| ``ProviderId`` | да               | id поставщика, постовщиков может быть несколько, список всех доступных поставщиков: /xml/providers |
+----------------+------------------+----------------------------------------------------------------------------------------------------+

Элемент PickUp
--------------

В элементе указываются параметры посадки (как аттрибуты).

- Обязательный элемент.

Аттрибуты:

+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип** | **Обязательный** | **Описание**                                                                                       |
+==================+=========+==================+====================================================================================================+
| ``cityId``       | число   | да               | id города, список всех доступных городов /xml/cities                                               |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationType`` | число   | да               | id локации трансфера, список всех доступных локаций /xml/transfer\_locations                       |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationId``   | число   | нет              | id аэропорта или станции, список всех доступных аэропортов /xml/airports , станций - /xml/stations |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+

Дочерних элементов нет.

Элемент DropOff
---------------

В элементе указываются параметры высадки (как аттрибуты).

- Обязательный элемент.

Аттрибуты:

+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип** | **Обязательный** | **Описание**                                                                                       |
+==================+=========+==================+====================================================================================================+
| ``cityId``       | число   | да               | id города, список всех доступных городов /xml/cities                                               |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationType`` | число   | да               | id локации трансфера, список всех доступных локаций /xml/transfer\_locations                       |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationId``   | число   | нет              | id аэропорта или станции, список всех доступных аэропортов /xml/airports , станций - /xml/stations |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+

Дочерних элементов нет.

Ответ на поиск трансферов, TransferSearchResponse
-------------------------------------------------

XML-схема ответа:

::

    <?xml version="1.0" encoding="utf-8"?>

    <TransferSearchResponse>
      <TransferSearchRequest>... исходный запрос ...</TransferSearchRequest>
      <Errors>
        <Error code="..." description="..."> - ошибки
      </Errors>

      <TransferSearch searchId="id" >
         <SearchPickUp  
        countryId="id"
        countryName="..."
        resortId="id"
        resortName="..."
        cityid="id"
        cityName="..." /> - посадка
         <SearchDropOff  
        countryId="id"
        countryName="..."
        resortId="id"
        resortName="..."
        cityid="id"
        cityName="..." /> - высадка
      </TransferSearch >
            
      <Transfers>
        <Transfer
        resultId="id"
        transferName="..." 
        [providerId="id"] -- поля может не быть, в зависимости от настроек пользователя
        confirmation="onRequest|online|inaccessible"  -- вид подтверждения
            price="orig_price"  -- цена в валюте currency
            currency=".."
        comparePrice=" -- цена в рублях
        [useNds="true|false"]
        passengers=".." -- максимально пассажиров
        [transferTime="true|false"] -- время трансфера
        [checkInTime="true|false"] -- время регистрации
        >
        <Language id=".." > </Language>
        <Vehicle id=".." >
           <Name >...</Name>
           <Description >...</Description>
        </Vehicle>
        <PickUp
          cityId="id"
          locationType="id"
         [locationId="id"]/>
        <DropOff
          cityId="id"
          locationType="id"
         [locationId="id"]/>
        </Transfer>
      </Transfers>
    </TransferSearchResponse>

Элемент TransferSearchResponse
------------------------------

Ответ, сформированный сервером на поиск трансферов **TransferSearchRequest**.

- Корневой элемент.
- Аттрибутов нет.

Дочерние элементы ``TransferSearchResponse``:

+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
| **Элемент**               | **Обязательный** | **Описание**                                      |                                                  |                           |
+===========================+==================+===================================================+==================================================+===========================+
| ``TransferSearchRequest`` | нет              | Исходный запрос, см. выше – TransferSearchRequest |                                                  |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
| ``Errors``                | нет              | Список ошибок, если есть                          |                                                  |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           | **Элемент**      | **Обязательный**                                  | **Описание**                                     |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           | ``Error``        | да                                                | Описание ошибки (и код), ошибок может быть много |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
| ``TransferSearch``        | нет              | Параметры запроса на поиск трансферов             |                                                  |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
| ``Transfers``             | нет              | Список найденных трансферов                       |                                                  |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           | **Элемент**      | **Обязательный**                                  | **Описание**                                     |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           | ``Transfer``     | нет                                               | Найденный трансфер                               |                           |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           |                  | **Элемент**                                       | **Обязательный**                                 | **Описание**              |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           |                  | ``Language``                                      | да                                               | Язык ``Language``         |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           |                  | ``Vehicle``                                       | да                                               | Транспорт ``Vehicle``     |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           |                  | ``PickUp``                                        | да                                               | Посадка ``PickUp``        |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           |                  | ``DropOff``                                       | да                                               | Высадка ``DropOff``       |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+
|                           |                  | ``Information``                                   | да                                               | Дополнительная информация |
+---------------------------+------------------+---------------------------------------------------+--------------------------------------------------+---------------------------+

Элемент TransferSearchRequest
-----------------------------

Исходный XML-запрос, который передал пользователь.

| Необязательный элемент. Отсутствует если исходный XML-запрос содержал ошибки в синтаксисе.
| Описание схемы элемента см. выше (``TransferSearchRequest``)

Элемент Errors
--------------

Смотри страницу :doc:`Ошибки <../errors>`


Элемент TransferSearch
----------------------

Параметры поиска трансферов.

- Необязательный элемент. Может отсутствовать, если возникли ошибки.

Аттрибуты:

+----------------+-----------+--------------------+----------------+
| **Аттрибут**   | **Тип**   | **Обязательный**   | **Описание**   |
+----------------+-----------+--------------------+----------------+
| ``searchId``   | число     | да                 | id поиска      |
+----------------+-----------+--------------------+----------------+

Дочерние элементы:

+----------------------+--------------------+----------------+
| **Элемент**          | **Обязательный**   | **Описание**   |
+----------------------+--------------------+----------------+
| ``SearchPickUp ``    | да                 | посадка        |
+----------------------+--------------------+----------------+
| ``SearchDropOff ``   | да                 | высадка        |
+----------------------+--------------------+----------------+

Элемент SearchPickUp
--------------------

Параметры посадки.

- Дочерние элементов нет.

Аттрибуты:

+-----------------+---------+------------------+---------------------------------------------------------+
| **Аттрибут**    | **Тип** | **Обязательный** | **Описание**                                            |
+=================+=========+==================+=========================================================+
| ``countryId``   | число   | да               | id страны. Список всех доступных стран /xml/countries   |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``countryName`` | строка  | да               | Название страны                                         |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``resortId``    | число   | да               | id курорта. Список всех доступных курортов /xml/resorts |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``resortName``  | строка  | да               | Название курорта                                        |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``cityId``      | число   | да               | id города. Список всех доступных городов /xml/cities    |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``cityName``    | строка  | да               | Название города                                         |
+-----------------+---------+------------------+---------------------------------------------------------+

Элемент SearchDropOff
---------------------

Параметры высадки.
- Дочерние элементов нет.

Аттрибуты:

+-----------------+---------+------------------+---------------------------------------------------------+
| **Аттрибут**    | **Тип** | **Обязательный** | **Описание**                                            |
+=================+=========+==================+=========================================================+
| ``countryId``   | число   | да               | id страны. Список всех доступных стран /xml/countries   |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``countryName`` | строка  | да               | Название страны                                         |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``resortId``    | число   | да               | id курорта. Список всех доступных курортов /xml/resorts |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``resortName``  | строка  | да               | Название курорта                                        |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``cityId``      | число   | да               | id города. Список всех доступных городов /xml/cities    |
+-----------------+---------+------------------+---------------------------------------------------------+
| ``cityName``    | строка  | да               | Название города                                         |
+-----------------+---------+------------------+---------------------------------------------------------+

Элемент Transfers
-----------------

Список трансферов (дочерние элементы ``Transfer``).

- Необязательный элемент. Может отсутствовать, если возникли ошибки.
- Аттрибутов нет.

Дочерние элементы ``Transfers``:

+--------------+------------------+-----------------------------------+---------------------------+
| **Элемент**  | **Обязательный** | **Описание**                      |                           |
+==============+==================+===================================+===========================+
| ``Transfer`` | нет              | Найденный трансфер, его аттрибуты |                           |
+--------------+------------------+-----------------------------------+---------------------------+
|              | **Элемент**      | **Обязательный**                  | **Описание**              |
+--------------+------------------+-----------------------------------+---------------------------+
|              | ``Language``     | да                                | Язык ``Language``         |
+--------------+------------------+-----------------------------------+---------------------------+
|              | ``Vehicle``      | да                                | Транспорт ``Vehicle``     |
+--------------+------------------+-----------------------------------+---------------------------+
|              | ``PickUp``       | да                                | Посадка ``PickUp``        |
+--------------+------------------+-----------------------------------+---------------------------+
|              | ``DropOff``      | да                                | Высадка ``DropOff``       |
+--------------+------------------+-----------------------------------+---------------------------+
|              | ``Information``  | да                                | Дополнительная информация |
+--------------+------------------+-----------------------------------+---------------------------+

Элемент Transfer
^^^^^^^^^^^^^^^^

Содержит список параметров(аттрибутов) конкретного трансфера, его язык, транспорт, место посадки и высадки.
Необязательный элемент. Может отсутствовать, если возникли ошибки или нет подходящих под критерии поиска трансферов.

Аттрибуты элемента ``Transfer``:

+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип**                         | **Обязательный** | **Описание**                                                                                            |
+==================+=================================+==================+=========================================================================================================+
| ``resultId``     | число                           | да               | id результата. Свой для каждого найденного трансфера.                                                   |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``transferName`` | строка                          | нет              | Название (краткое описание) трансфера                                                                   |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``providerId``   | число                           | нет              | id поставщика, который предоставил информацию об этом трансфере. Эта информация предоставляется не всем |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``confirmation`` | onRequest, online, inaccessible | да               | Вид подтверждения («по запросу», «онлайн» и «недоступен» соответственно).                               |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``price``        | цена                            | да               | Цена в валюте ``currency``                                                                              |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``currency``     | строка                          | да               | Название валюты трансфера                                                                               |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``comparePrice`` | цена                            | да               | Цена в рублях                                                                                           |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``useNds``       | true, false                     | нет              | Включен ли НДС (true – да, false – нет). Если аттрибут отсутствует - не облагается налогом              |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``passengers``   | число                           | да               | Максимальное число пассажиров                                                                           |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``transferTime`` | строка                          | нет              | Время трансфера                                                                                         |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+
| ``checkInTime``  | строка                          | нет              | Время регистрации                                                                                       |
+------------------+---------------------------------+------------------+---------------------------------------------------------------------------------------------------------+

Дочерние элементы ``Transfer``: ``Language``, ``Vehicle``, ``PickUp``, ``DropOff``, ``Information``

Элемент Language
''''''''''''''''

Язык трансфера.

- Обязательный элемент.
- Аттрибуты: id языка (из словаря /xml/languages)
- Дочерних элементов нет.

Элемент Vehicle
'''''''''''''''

Транспорт трансфера.

- Обязательный элемент.
- Аттрибуты: id транспорта (из словаря /xml/transfer\_vehicles)

Дочерние элементы:

+-----------------+------------------+---------------------+
| **Элемент**     | **Обязательный** | **Описание**        |
+=================+==================+=====================+
| ``Name``        | да               | Название транспорта |
+-----------------+------------------+---------------------+
| ``Description`` | да               | Описание транспорта |
+-----------------+------------------+---------------------+

Элемент PickUp
--------------

В элементе указываются параметры посадки (как аттрибуты).

- Обязательный элемент.

Аттрибуты:

+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип** | **Обязательный** | **Описание**                                                                                       |
+==================+=========+==================+====================================================================================================+
| ``cityId``       | число   | да               | id города, список всех доступных городов /xml/cities                                               |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationType`` | число   | да               | id локации трансфера, список всех доступных локаций /xml/transfer\_locations                       |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationId``   | число   | нет              | id аэропорта или станции, список всех доступных аэропортов /xml/airports , станций - /xml/stations |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+

Дочерних элементов нет.

Элемент DropOff
---------------

В элементе указываются параметры высадки (как аттрибуты).

- Обязательный элемент.

Аттрибуты:

+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| **Аттрибут**     | **Тип** | **Обязательный** | **Описание**                                                                                       |
+==================+=========+==================+====================================================================================================+
| ``cityId``       | число   | да               | id города, список всех доступных городов /xml/cities                                               |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationType`` | число   | да               | id локации трансфера, список всех доступных локаций /xml/transfer\_locations                       |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+
| ``locationId``   | число   | нет              | id аэропорта или станции, список всех доступных аэропортов /xml/airports , станций - /xml/stations |
+------------------+---------+------------------+----------------------------------------------------------------------------------------------------+

Дочерних элементов нет.


Элемент Information
-------------------
Дополнительная информация.


Элемент SearchId
----------------

В случае, если запрашиваются трансферы асинхронным способом (с указанием
параметра ?async=1), то элемент будет содержать id инициализированного
поиска. Данный ответ придет сразу, на стороне Хотелбука фоново будет
происходить поиск трансферов. Найденные трансферы можно запрашивать
периодически запросом ``/xml/transfer_search_async?login=&search_id=&from_result_id=``
(например каждую секунду). Более подробно см. `transfer-search-async.html <transfer-search-async.html>`_
Необязательный элемент. Может отсутствовать, если возникли ошибки.